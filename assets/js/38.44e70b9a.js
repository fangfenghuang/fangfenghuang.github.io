(window.webpackJsonp=window.webpackJsonp||[]).push([[38],{363:function(s,a,t){"use strict";t.r(a);var e=t(0),n=Object(e.a)({},(function(){var s=this,a=s._self._c;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h1",{attrs:{id:"参考"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#参考"}},[s._v("#")]),s._v(" 参考：")]),s._v(" "),a("ul",[a("li",[a("a",{attrs:{href:"https://github.com/kata-containers/kata-containers/blob/main/docs/design/host-cgroups.md",target:"_blank",rel:"noopener noreferrer"}},[s._v("host-cgroups.md"),a("OutboundLink")],1)]),s._v(" "),a("li",[a("a",{attrs:{href:"https://github.com/kata-containers/kata-containers/blob/main/docs/design/vcpu-handling.md",target:"_blank",rel:"noopener noreferrer"}},[s._v("vcpu-handling.md"),a("OutboundLink")],1)])]),s._v(" "),a("h1",{attrs:{id:"结论"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#结论"}},[s._v("#")]),s._v(" 结论")]),s._v(" "),a("ul",[a("li",[s._v("cgroupsPath的路径根据Qos类别不同")]),s._v(" "),a("li",[s._v("kata_overhead的cpu和mem没有限制，能用到宿主机所有资源，如果不开启sandbox_cgroup_only会导致主机资源被抢占")]),s._v(" "),a("li",[s._v("kubepod cgroup限制=limit+overhead，容器业务负载就是在这个限制之内使用，然后区分sandbox_cgroup_only是否开启决定kata vm(sandbox)开销是否统计到kubepod中，如果是则业务申请cpu mem资源就必须考虑kata sandbox开销")]),s._v(" "),a("li",[s._v("虚拟机大小=kata vm中或者说pod中看到的cpu mem（lscpu lsmem）=default+limit（见验证1）")]),s._v(" "),a("li",[s._v("kubectl describe node | grep test-kata看到的资源申请=limit+overhead（同runc）（见验证1）")]),s._v(" "),a("li",[s._v("kubectl top pod看到的是业务真正的负载开销？？")]),s._v(" "),a("li",[s._v("pod overhead会影响调度，overhead只作用于sandbox开销，不能作用于业务负载（见验证3）")]),s._v(" "),a("li",[s._v("为了限制资源抢占问题，建议开启sandbox_cgroup_only=true,overhead建议不设置（待定），以下说明均在sandbox_cgroup_only=true前提下进行说明")]),s._v(" "),a("li",[s._v("业务负载+sandbox开销最大能使用的资源限制=limit+overhead（overhead部分只能是额外开销用）（见验证3）")]),s._v(" "),a("li",[s._v("default_vcpus/memory，影响虚拟机的大小/启动时间，这个值官方不建议修改")]),s._v(" "),a("li",[s._v("如果container未设置limit，则kubepod cgroup无限制（但是业务负载只能使用default设置的1G2G???暂未找到在哪做的限制）（见验证7）；如果设置了limit，则这个default则只影响虚拟机大小，但不影响kubepod cgroup限制（见验证1）")]),s._v(" "),a("li",[s._v("~"),a("s",[s._v("一个Pod的最小规格是1C 256M，当低于 256M 时，会重置为 2G。，支持的最大内存规格是256GB。如果用户分配的内存规格超过256GB，可能会出现未定义的错误，安全容器暂不支持超过256GB的大内存场景。")]),s._v("~（未找到官方出处，应该只是openEuler内部做的限制）（见验证5）")]),s._v(" "),a("li",[s._v("如果不设置request，则request的值和limit默认相等")])]),s._v(" "),a("h1",{attrs:{id:"一些验证"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#一些验证"}},[s._v("#")]),s._v(" 一些验证")]),s._v(" "),a("h2",{attrs:{id:"验证1-查看cgroup大小"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#验证1-查看cgroup大小"}},[s._v("#")]),s._v(" 验证1： 查看cgroup大小")]),s._v(" "),a("p",[s._v("cpu.cfs_period_us是CFS算法的一个调度周期，一般它的值是100000us，即100ms。\ncpu.cfs_quota_us表示在CFS算法中，在一个调度周期里该控制组被允许的运行时间，比如这个值为50000时，就是50ms。用这个值去除以调度周期cpu.cfs_period_us，即50ms/100ms=0.5，得到的值表示该控制组被允许使用的CPU最大配额是0.5个CPU。在我的系统里，这个值是-1，为默认值，表示不限制。")]),s._v(" "),a("p",[s._v('default_vcpu=1\ndefault_memory=2Gi\noverhead: "podFixed":{"cpu":"250m","memory":"160Mi"}\npod Qos:\nresources:\nrequests:\nmemory: "500Mi"\ncpu: "0.5"\nlimits:\nmemory: "3000Mi"\ncpu: "4"')]),s._v(" "),a("h3",{attrs:{id:"sandbox-cgroup-only-true"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#sandbox-cgroup-only-true"}},[s._v("#")]),s._v(" sandbox_cgroup_only=true")]),s._v(" "),a("p",[s._v('"cgroupsPath": "/kubepods/burstable/pod287707dd-0fda-4fab-874d-e1b00e87390a/c2bfeccb7580707e7559c00f7ee9d46e98745cc2a0d267fbb41c68da41df784f",')]),s._v(" "),a("p",[s._v("kata_overhead-mem: ~8G（不限）\nkata_overhead-cpu: -1（不限）\nkubepods_mem: 3313500160 (~3.08G)  (limit+overhead)\nkubepods_cpu cfs_period_us: 100000  cpu.cfs_quota_us 425000  (4.25核) （limit+overhead）")]),s._v(" "),a("p",[s._v("lscpu: 5 (default+limit)\nlsmem：\nMemory block size:       128M\nMemory block size:       128M\nTotal online memory:       5G (default+limit)")]),s._v(" "),a("p",[s._v("kubectl describe node | grep test-kata： 750m (9%)     4250m (54%)(limit+overhead)  660Mi (10%)      3160Mi (48%)(limit+overhead)   4m54s\nkubectl top pod： 1002m        1Mi\nkubectl top node： 1306m        16%    5513Mi          84%")]),s._v(" "),a("p",[s._v("[root@localhost ~]# systemd-cgtop | grep kata\n/kata_overhead                                                                 -      -     4.9M        -        -\n/system.slice/kata-monitor.service                                             1      -    27.4M        -        -\n[root@localhost ~]# systemd-cgtop | grep pod287707dd-0fda-4fab-874d-e1b00e87390a\n/kubepods/burstable/pod287707dd-0fda-4fab-874d-e1b00e87390a                    -      -   193.4M        -        -")]),s._v(" "),a("h3",{attrs:{id:"sandbox-cgroup-only-false-结果同-true"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#sandbox-cgroup-only-false-结果同-true"}},[s._v("#")]),s._v(" sandbox_cgroup_only=false（结果同=true）")]),s._v(" "),a("p",[s._v('"cgroupsPath": "/kubepods/burstable/pod3a449bdd-90d5-41fd-a57a-9cfd102f9e44/87b5990ce61e4ff193124fc60e4a68c7061cf9299688c6c521cae29103bc3ef5",')]),s._v(" "),a("p",[s._v("kata_overhead-mem: ~8G（不限）\nkata_overhead-cpu: -1（不限）")]),s._v(" "),a("p",[s._v("kubepods_mem: 3313500160 (~3.08G)  (limit+overhead)\nkubepods_cpu cfs_period_us: 100000  cpu.cfs_quota_us 425000  (4.25核) （limit+overhead）")]),s._v(" "),a("p",[s._v("[root@localhost ~]# systemd-cgtop | grep kata\n/kata_overhead                                                                 -      -     4.9M        -        -\n/system.slice/kata-monitor.service                                             1      -    24.6M        -        -\n[root@localhost ~]# systemd-cgtop | grep pod3a449bdd-90d5-41fd-a57a-9cfd102f9e44\n/kubepods/burstable/pod3a449bdd-90d5-41fd-a57a-9cfd102f9e44                    -      -   151.7M        -        -")]),s._v(" "),a("p",[s._v("kubectl describe node | grep test-kata： 750m (9%)     4250m (54%)(limit+overhead)  660Mi (10%)      3160Mi (48%)(limit+overhead)   4m54s\nkubectl top pod： 1002m        1Mi\nkubectl top node：  1330m        17%    5507Mi          84%")]),s._v(" "),a("h3",{attrs:{id:"查看命令"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#查看命令"}},[s._v("#")]),s._v(" 查看命令：")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@localhost ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# systemd-cgtop | grep kata")]),s._v("\n/kata_overhead                                                                                                                -      -     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v(".9M        -        -\n/kubepods/pod24356d87-3993-4e9a-8d3f-55207af763f9/kata_842463ada9994438f6c663b082bbf5735c64309f77a0b57838b8a16f347433a6       "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("7")]),s._v("      -   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("132")]),s._v(".9M        -        -\n/system.slice/kata-monitor.service                                                                                            "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("      -    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("23")]),s._v(".2M        -        -\n\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@localhost ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# cat /sys/fs/cgroup/memory/kata_overhead/memory.limit_in_bytes")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("9223372036854771712")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@localhost ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#  cat /sys/fs/cgroup/cpu/kata_overhead/cpu.cfs_period_us")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("100000")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@localhost ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# cat /sys/fs/cgroup/cpu/kata_overhead/cpu.cfs_quota_us")]),s._v("\n-1\n\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@localhost ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# cat /sys/fs/cgroup/memory/kubepods/pod24356d87-3993-4e9a-8d3f-55207af763f9/memory.limit_in_bytes")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1241513984")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@localhost ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# cat /sys/fs/cgroup/cpu/kubepods/pod24356d87-3993-4e9a-8d3f-55207af763f9/cpu.cfs_period_us")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("100000")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@localhost ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# cat /sys/fs/cgroup/cpu/kubepods/pod24356d87-3993-4e9a-8d3f-55207af763f9/cpu.cfs_quota_us")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("125000")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@localhost ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#  cat /sys/fs/cgroup/memory/system.slice/kata-monitor.service/memory.limit_in_bytes")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("9223372036854771712")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@localhost ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kubectl top pod test-kata")]),s._v("\nNAME        CPU"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("cores"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("   MEMORY"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("bytes"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\ntest-kata   0m           2Mi\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@localhost ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kubectl top node")]),s._v("\nNAME                    CPU"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("cores"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("   CPU%   MEMORY"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("bytes"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("   MEMORY%\nlocalhost.localdomain   355m         "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v("%     5469Mi          "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("83")]),s._v("%\n\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@localhost ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kubectl describe node | grep kata")]),s._v("\n  default                     test-kata                                                1250m "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("16")]),s._v("%"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("   1250m "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("16")]),s._v("%"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("  1184Mi "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("18")]),s._v("%"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("     1184Mi "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("18")]),s._v("%"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("   16d\n  kube-system                 kata-deploy-q2cnv                                        "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("%"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("        "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("%"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("       "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("%"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("           "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("%"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("         21d\n\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br"),a("span",{staticClass:"line-number"},[s._v("32")]),a("br"),a("span",{staticClass:"line-number"},[s._v("33")]),a("br")])]),a("h2",{attrs:{id:"验证2-如果不设置request-limit-kubepod-cgroup的限制是怎样的"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#验证2-如果不设置request-limit-kubepod-cgroup的限制是怎样的"}},[s._v("#")]),s._v(" 验证2：如果不设置request limit，kubepod cgroup的限制是怎样的")]),s._v(" "),a("p",[s._v('"cgroupsPath": "/kubepods/besteffort/pod09a392bc-1080-4044-8015-39f392e3862f/367368f8f5c44bc69b277febfa5d533063f096c65cd9b6729bbc7847a582f51f",')]),s._v(" "),a("p",[s._v("kata_overhead-mem: ~8G（不限）\nkata_overhead-cpu: -1（不限）")]),s._v(" "),a("p",[s._v("kubepods_mem: 9223372036854771712  ~8G（不限）\nkubepods_cpu cfs_period_us cfs_quota_us: 100000 -1 不限\nkubectl top pod：  1000m        0Mi\nkubectl top node：  1316m        16%    5517Mi          84%")]),s._v(" "),a("p",[s._v("[root@localhost hff]# systemd-cgtop | grep kata\n/kata_overhead                                                                 -      -     4.9M        -        -\n/system.slice/kata-monitor.service                                             1      -    25.1M        -        -")]),s._v(" "),a("p",[s._v("[root@localhost hff]# systemd-cgtop | grep pod09a392bc-1080-4044-8015-39f392e3862f\n/kubepods/besteffort/pod09a392bc-1080-4044-8015-39f392e3862f                   -      -    95.8M        -        -")]),s._v(" "),a("p",[s._v("kubectl describe node | grep test-kata： 250m (3%)（overhead）     0 (0%)      160Mi (2%)（overhead）       0 (0%)         6m30s")]),s._v(" "),a("p",[s._v("kubepod不限制，但是pod确实只能用到limit的值")]),s._v(" "),a("h2",{attrs:{id:"验证3-验证overhead是否影响业务负载"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#验证3-验证overhead是否影响业务负载"}},[s._v("#")]),s._v(" 验证3： 验证overhead是否影响业务负载")]),s._v(" "),a("p",[s._v("设置overhead 2C 2G后，limit 3C3G, 打满cpu=6,mem=3Gi")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@localhost hff"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kubectl get pod")]),s._v("\nNAME                              READY   STATUS        RESTARTS   AGE\ntest-kata-5687cdcb66-28lgn        "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("/1     OutOfmemory   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          17s\ntest-kata-5687cdcb66-2lmd5        "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("/1     OutOfmemory   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          11s\ntest-kata-5687cdcb66-2pbhm        "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("/1     OutOfmemory   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          23s\ntest-kata-5687cdcb66-575sb        "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("/1     OutOfmemory   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          19s\ntest-kata-5687cdcb66-5gvt2        "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("/1     OutOfmemory   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          5s\ntest-kata-5687cdcb66-62fbd        "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("/1     OutOfmemory   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          33s\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br")])]),a("h2",{attrs:{id:"验证4-验证如果不设置request-limit-cpu-mem的使用上线"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#验证4-验证如果不设置request-limit-cpu-mem的使用上线"}},[s._v("#")]),s._v(" 验证4：验证如果不设置request limit，cpu mem的使用上线")]),s._v(" "),a("p",[s._v("设置overhead 2C 2G后，limit不设置， 打满cpu=6,mem=1Gi")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@localhost hff"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kubectl get pod  -w")]),s._v("\nNAME                              READY   STATUS        RESTARTS   AGE\ntest-kata-55867ffb58-26ndp        "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("/1     OutOfmemory   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          4s\ntest-kata-55867ffb58-2blnx        "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("/1     OutOfmemory   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          2s\ntest-kata-55867ffb58-2d858        "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("/1     OutOfmemory   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          1s\ntest-kata-55867ffb58-2qwzf        "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("/1     Pending       "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          0s\ntest-kata-55867ffb58-4j4hl        "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("/1     OutOfmemory   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          1s\ntest-kata-55867ffb58-8zzbc        "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("/1     OutOfmemory   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          2s\ntest-kata-55867ffb58-crflb        "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("/1     OutOfmemory   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          4s\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br")])]),a("h2",{attrs:{id:"验证5-验证cpu-mem小于1c-256mi的情况-no-overhead"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#验证5-验证cpu-mem小于1c-256mi的情况-no-overhead"}},[s._v("#")]),s._v(" 验证5： 验证cpu mem小于1C 256Mi的情况（no overhead）")]),s._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",[a("code",[s._v('    resources:\n      requests:\n        memory: "1Mi"\n        cpu: "0.1"\n      limits:\n        memory: "100Mi"\n        cpu: "550m"\n    args:\n    - -cpus\n    - "2"\n    - -mem-total\n    - 100Mi\n    - -mem-alloc-size\n    - 10Mi\n    - -mem-alloc-sleep\n    - 1s\n')])])]),a("p",[s._v("没有OOM，但是pod不断重启，所有并没有被重置成2G")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@localhost hff"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kubectl get pod -w")]),s._v("\nNAME                              READY   STATUS    RESTARTS   AGE\nkubefilebrowser-896974bcc-z6scd   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("/1     Running   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v("          31d\ntest-kata-6878f4fd9f-76c5k        "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("/1     Running   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("          61s\ntest-runc-79d8bdc4cb-v6j28        "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("/1     Running   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          75m\ntest-kata-6878f4fd9f-76c5k        "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("/1     Error     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("          72s\ntest-kata-6878f4fd9f-76c5k        "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("/1     CrashLoopBackOff   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("          75s\n\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@localhost hff"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kubectl logs test-kata-6878f4fd9f-76c5k")]),s._v("\nI0527 07:16:06.932758       "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" main.go:26"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" Allocating "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"200Mi"')]),s._v(" memory, "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"10Mi"')]),s._v(" chunks, with a 1s "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sleep")]),s._v(" between allocations\nI0527 07:16:06.933058       "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" main.go:39"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" Spawning a thread to consume CPU\nI0527 07:16:06.933082       "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" main.go:39"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" Spawning a thread to consume CPU\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br")])]),a("h2",{attrs:{id:"验证6-极小资源占用测试"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#验证6-极小资源占用测试"}},[s._v("#")]),s._v(" 验证6： 极小资源占用测试")]),s._v(" "),a("p",[s._v("limit550m/200Mi，压2C100Mi，pod会不断重启，但是不是OOMKilled")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("        resources:\n          requests:\n            memory: "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"1Mi"')]),s._v("\n            cpu: "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"0.1"')]),s._v("\n          limits:\n            memory: "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"200Mi"')]),s._v("\n            cpu: "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"550m"')]),s._v("\n        args:\n        - -cpus\n        - "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"2"')]),s._v("\n        - -mem-total\n        - 100Mi\n        - -mem-alloc-size\n        - 10Mi\n        - -mem-alloc-sleep\n        - 1s\nEvents:\n  Type     Reason          Age                   From                            Message\n  ----     ------          ----                  ----                            -------\n  Normal   Scheduled       "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("unknown"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("             default-scheduler               Successfully assigned default/test-kata-68b77bc9f8-zlj5p to localhost.localdomain\n  Normal   Created         36m "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("x4 over 38m"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("     kubelet, localhost.localdomain  Created container cpu-stress-kata\n  Normal   Started         36m "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("x4 over 38m"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("     kubelet, localhost.localdomain  Started container cpu-stress-kata\n  Normal   SandboxChanged  35m "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("x4 over 37m"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("     kubelet, localhost.localdomain  Pod sandbox changed, it will be killed and re-created.\n  Normal   Pulled          7m53s "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("x11 over 38m"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("  kubelet, localhost.localdomain  Container image "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"vish/stress"')]),s._v(" already present on machine\n  Warning  BackOff         3m5s "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("x159 over 37m"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("  kubelet, localhost.localdomain  Back-off restarting failed container\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@localhost hff"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@localhost hff"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kubectl logs test-kata-68b77bc9f8-zlj5p")]),s._v("\nI0527 08:13:52.926368       "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" main.go:26"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" Allocating "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"100Mi"')]),s._v(" memory, "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"10Mi"')]),s._v(" chunks, with a 1s "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sleep")]),s._v(" between allocations\nI0527 08:13:52.926544       "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" main.go:39"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" Spawning a thread to consume CPU\nI0527 08:13:52.926570       "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" main.go:39"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" Spawning a thread to consume CPU\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br")])]),a("h2",{attrs:{id:"验证7-查看kata-vm中的cgroup"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#验证7-查看kata-vm中的cgroup"}},[s._v("#")]),s._v(" 验证7： 查看kata vm中的cgroup")]),s._v(" "),a("p",[s._v("不设置limit，overhead")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("bash-5.1"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# more /sys/fs/cgroup/memory/")]),s._v("\ncgroup.clone_children               memory.max_usage_in_bytes\ncgroup.event_control                memory.memsw.failcnt\ncgroup.procs                        memory.memsw.limit_in_bytes\ncgroup.sane_behavior                memory.memsw.max_usage_in_bytes\nkubepods/                           memory.memsw.usage_in_bytes\nmemory.failcnt                      memory.move_charge_at_immigrate\nmemory.force_empty                  memory.oom_control\nmemory.kmem.failcnt                 memory.pressure_level\nmemory.kmem.limit_in_bytes          memory.soft_limit_in_bytes\nmemory.kmem.max_usage_in_bytes      memory.stat\nmemory.kmem.slabinfo                memory.swappiness\nmemory.kmem.tcp.failcnt             memory.usage_in_bytes\nmemory.kmem.tcp.limit_in_bytes      memory.use_hierarchy\nmemory.kmem.tcp.max_usage_in_bytes  notify_on_release\nmemory.kmem.tcp.usage_in_bytes      release_agent\nmemory.kmem.usage_in_bytes          system.slice/\nmemory.limit_in_bytes               tasks\nbash-5.1"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# more /sys/fs/cgroup/memory/kubepods/")]),s._v("\nbesteffort/                         memory.max_usage_in_bytes\ncgroup.clone_children               memory.memsw.failcnt\ncgroup.event_control                memory.memsw.limit_in_bytes\ncgroup.procs                        memory.memsw.max_usage_in_bytes\nmemory.failcnt                      memory.memsw.usage_in_bytes\nmemory.force_empty                  memory.move_charge_at_immigrate\nmemory.kmem.failcnt                 memory.oom_control\nmemory.kmem.limit_in_bytes          memory.pressure_level\nmemory.kmem.max_usage_in_bytes      memory.soft_limit_in_bytes\nmemory.kmem.slabinfo                memory.stat\nmemory.kmem.tcp.failcnt             memory.swappiness\nmemory.kmem.tcp.limit_in_bytes      memory.usage_in_bytes\nmemory.kmem.tcp.max_usage_in_bytes  memory.use_hierarchy\nmemory.kmem.tcp.usage_in_bytes      notify_on_release\nmemory.kmem.usage_in_bytes          tasks\nmemory.limit_in_bytes\nbash-5.1"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# more /sys/fs/cgroup/cpu/cpu.cfs_quota_us")]),s._v("\n-1\nbash-5.1"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# more /sys/fs/cgroup/cpu/kubepods/besteffort/cpu.cfs_quota_us")]),s._v("\n-1\nbash-5.1"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# more /sys/fs/cgroup/cpu/kubepods/besteffort/pode0eb5953-c643-4429-8812-b8e36d75e3d9/f3cffcf893000b0c5f6105f1adb94e3be7fa62ebecd801a29b9a77a472d62c86/cfs_quota_us")]),s._v("\n-1\nbash-5.1"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# more /sys/fs/cgroup/memory/memory.limit_in_bytes")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("9223372036854771712")]),s._v("\nbash-5.1"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#  more /sys/fs/cgroup/memory/kubepods/memory.limit_in_bytes")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("9223372036854771712")]),s._v("\nbash-5.1"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#  more /sys/fs/cgroup/memory/kubepods/besteffort/memory.limit_in_bytes")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("9223372036854771712")]),s._v("\nbash-5.1"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#  more /sys/fs/cgroup/memory/kubepods/besteffort/pode0eb5953-c643-4429-8812-b8e36d75e3d9/.limit_in_bytes")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("9223372036854771712")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br"),a("span",{staticClass:"line-number"},[s._v("32")]),a("br"),a("span",{staticClass:"line-number"},[s._v("33")]),a("br"),a("span",{staticClass:"line-number"},[s._v("34")]),a("br"),a("span",{staticClass:"line-number"},[s._v("35")]),a("br"),a("span",{staticClass:"line-number"},[s._v("36")]),a("br"),a("span",{staticClass:"line-number"},[s._v("37")]),a("br"),a("span",{staticClass:"line-number"},[s._v("38")]),a("br"),a("span",{staticClass:"line-number"},[s._v("39")]),a("br"),a("span",{staticClass:"line-number"},[s._v("40")]),a("br"),a("span",{staticClass:"line-number"},[s._v("41")]),a("br"),a("span",{staticClass:"line-number"},[s._v("42")]),a("br"),a("span",{staticClass:"line-number"},[s._v("43")]),a("br"),a("span",{staticClass:"line-number"},[s._v("44")]),a("br"),a("span",{staticClass:"line-number"},[s._v("45")]),a("br"),a("span",{staticClass:"line-number"},[s._v("46")]),a("br"),a("span",{staticClass:"line-number"},[s._v("47")]),a("br"),a("span",{staticClass:"line-number"},[s._v("48")]),a("br"),a("span",{staticClass:"line-number"},[s._v("49")]),a("br")])]),a("p",[s._v("未找到default_vcpu/memory是在哪里做的限制")]),s._v(" "),a("h1",{attrs:{id:"kata-cgroup说明"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#kata-cgroup说明"}},[s._v("#")]),s._v(" kata cgroup说明")]),s._v(" "),a("p",[s._v("Kata Containers 在两层 cgroup 上运行。")]),s._v(" "),a("ul",[a("li",[s._v("workload guest")]),s._v(" "),a("li",[s._v("VMM host\n（Kata Containers 在两层 cgroup 上运行。第一层在虚拟机中放置工作负载，而第二层在主机上运行 VMM和 关联线程。）")])]),s._v(" "),a("p",[s._v("从 Kubernetes 角度来讲，Cgroup 指的是 Pod Cgroup，由 Kubelet 创建，限制的是 Pod 的资源; 从 Container 角度来讲，Cgroup 指的是 Container Cgroup，由对应的 runtime 创建，限制的是 container 的资源。但是为了可以获取到更准确的容器资源，Kubelet 会根据 Container Cgroup 去调整 Pod Cgroup。 在传统的 runtime 中，两者没有太大的区别。")]),s._v(" "),a("p",[s._v("而 Kata Containers 引入 VM 的概念，所以针对这种情况有两种处理方式：")]),s._v(" "),a("ul",[a("li",[s._v("启用 SandboxCgroupOnly（默认），Kubelet 在调整 Pod Cgroup 的大小时，会将 sandbox 的开销统计进去\n（就是说，用户申请的资源limit+overhead是业务负载和kata虚拟机开销的最大使用限制，如果不设置limit，默认是default_vcpus/mem??）")]),s._v(" "),a("li",[s._v("禁用 SandboxCgroupOnly，sandbox 的开销和 Pod Cgroup 分开计算，独立存在\n（就是说，用户申请的资源limit+overhead是业务负载自己的最大使用限制，kata虚拟机开销单独一个cgroup而且没有限制，如果不设置limit，业务使用默认是default_vcpus/mem）")])]),s._v(" "),a("h2",{attrs:{id:"两种cgrouppath"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#两种cgrouppath"}},[s._v("#")]),s._v(" 两种cgrouppath:")]),s._v(" "),a("ul",[a("li",[s._v("/kubepods/burstable/pod287707dd-0fda-4fab-874d-e1b00e87390a/c2bfeccb7580707e7559c00f7ee9d46e98745cc2a0d267fbb41c68da41df784f\n()")]),s._v(" "),a("li",[s._v("/kubepods/pod24356d87-3993-4e9a-8d3f-55207af763f9/kata_842463ada9994438f6c663b082bbf5735c64309f77a0b57838b8a16f347433a6\n()")])]),s._v(" "),a("h2",{attrs:{id:"pod-overhead"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#pod-overhead"}},[s._v("#")]),s._v(" pod overhead")]),s._v(" "),a("h2",{attrs:{id:"sandbox-cgroup-only"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#sandbox-cgroup-only"}},[s._v("#")]),s._v(" sandbox_cgroup_only")]),s._v(" "),a("ul",[a("li",[s._v("如果启用，运行时将在一个专用cgroup中添加所有kata进程。每个沙盒只创建一个cgroup，主机中的container cgroup将不会创建")]),s._v(" "),a("li",[s._v("kata runtime调用者可以自由地限制或收集整个Kata沙盒的cgroup统计信息。")]),s._v(" "),a("li",[s._v("sandbox cgroup路径是具有PodSandbox annotation(???)的容器的父cgroup。")]),s._v(" "),a("li",[s._v("如果没有container type annotation(??)，则sandbox cgroup将受到限制")]),s._v(" "),a("li",[s._v("意味着 pod cgroup 的大小适当，并考虑了 pod 开销（设置podoverhead考虑调度）")]),s._v(" "),a("li",[s._v("Kata shim 将在sandbox_cgroup_onlypod 的专用 cgroup 下为每个 pod 创建一个子 cgroup")]),s._v(" "),a("li",[s._v("kata shim、qemu 线程将与沙箱在同一个 cgroup 中。在这种情况下，它们将与 vcpu 线程共享同一组 cpu 内核")])]),s._v(" "),a("p",[a("strong",[s._v("=true好处：")])]),s._v(" "),a("ul",[a("li",[s._v("便于Pod资源统计")]),s._v(" "),a("li",[s._v("更好的主机资源隔离")])]),s._v(" "),a("p",[a("strong",[s._v("=fasle优点及缺点：")])]),s._v(" "),a("ul",[a("li",[s._v("不限制会消耗大量主机资源")]),s._v(" "),a("li",[s._v("在专用开销cgroup下运行所有非vcpu线程可以提供有关实际的开销准确值，可以设置开销cgroup大小（手动修改，无接口）")])]),s._v(" "),a("h2",{attrs:{id:"default-vcpus-memory"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#default-vcpus-memory"}},[s._v("#")]),s._v(" default_vcpus/memory")]),s._v(" "),a("h2",{attrs:{id:"kata资源开销"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#kata资源开销"}},[s._v("#")]),s._v(" kata资源开销")]),s._v(" "),a("ul",[a("li",[s._v("半虚拟化 I/O 后端")]),s._v(" "),a("li",[s._v("VMM 实例")]),s._v(" "),a("li",[s._v("Kata shim 进程")]),s._v(" "),a("li",[s._v("kata monitor开销（如果开启）")])]),s._v(" "),a("h2",{attrs:{id:"kata组件进程"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#kata组件进程"}},[s._v("#")]),s._v(" kata组件进程：")]),s._v(" "),a("ul",[a("li",[s._v("sandbox qemu-system-x86_64进程cgroup")]),s._v(" "),a("li",[s._v("containerd-shim-kata-v2进程")]),s._v(" "),a("li",[s._v("两个virtiofsd进程")])]),s._v(" "),a("p",[s._v("kata pod起来后，其中，kata shim进程和qemu进程占用了大量的内存开销，其中，沙箱里的内核和 agent 是直接分享了应用内存但并不是应用的一部分，也就是说，这一部分是用户可见的开销。而 VMM 本身在宿主机上的开销以及 shim-v2 占用的内存，虽然用户应用不可见，但同样是 Kata 带来的开销，影响基础设施的资源效率。")]),s._v(" "),a("p",[s._v("这些内存开销里，还包括了可共享开销和不可共享开销。所有宿主这边的代码段内存（只读内存），可以共享 page cache，所以是共享的，而在沙箱里的代码（只读）内存，在使用 DAX 或模版的情况下，也可以共享同一份。所以，可以共享的内存开销在节点全局范围内是唯一一份，所以在有多个Pod的情况下，这部分的常数开销相对而言是不太重要的，相反的，不可共享开销，尤其是堆内存开销，会随着 Pod 的增长而增长，的换句话说，堆内存（匿名页）是最需要被重视的开销。")]),s._v(" "),a("p",[s._v("综上，第一位需要被遏制的开销是沙箱内的用户可见的不可共享开销，尤其是 Agent 的开销，而 VMM 和 shim 的匿名页开销次之。")]),s._v(" "),a("h2",{attrs:{id:"不支持cgroups-v2"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#不支持cgroups-v2"}},[s._v("#")]),s._v(" 不支持Cgroups V2")]),s._v(" "),a("h1",{attrs:{id:"一些需要知道的配置"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#一些需要知道的配置"}},[s._v("#")]),s._v(" 一些需要知道的配置")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Default number of vCPUs per SB/VM:")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# unspecified or 0                --\x3e will be set to 1（不设置或0则默认是1）")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# < 0                             --\x3e will be set to the actual number of physical cores(小于0则设为实际物理核)")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# > 0 <= number of physical cores --\x3e will be set to the specified number")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# > number of physical cores      --\x3e will be set to the actual number of physical cores（大于物理核默认为物理核）")]),s._v("\ndefault_vcpus "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Default memory size in MiB for SB/VM.")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# If unspecified then it will be set 2048 MiB.（不设置默认是2Gi）")]),s._v("\ndefault_memory "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2048")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Default maximum number of vCPUs per SB/VM:")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# unspecified or == 0             --\x3e will be set to the actual number of physical cores or to the maximum number（不设置或0默认为最大物理核数）")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#                                     of vCPUs supported by KVM if that number is exceeded")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# > 0 <= number of physical cores --\x3e will be set to the specified number")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# > number of physical cores      --\x3e will be set to the actual number of physical cores or to the maximum number")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#                                     of vCPUs supported by KVM if that number is exceeded")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# WARNING: Depending of the architecture, the maximum number of vCPUs supported by KVM is used when")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# the actual number of physical cores is greater than it.")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# WARNING: Be aware that this value impacts the virtual machine's memory footprint and CPU")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# the hotplug functionality. For example, `default_maxvcpus = 240` specifies that until 240 vCPUs")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# can be added to a SB/VM, but the memory footprint will be big. Another example, with")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# `default_maxvcpus = 8` the memory footprint will be small, but 8 will be the maximum number of")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# vCPUs supported by the SB/VM. In general, we recommend that you do not edit this variable,")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# unless you know what are you doing.")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# NOTICE: on arm platform with gicv2 interrupt controller, set it to 8.")]),s._v("\ndefault_maxvcpus "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br")])]),a("h2",{attrs:{id:"通过注释修改配置"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#通过注释修改配置"}},[s._v("#")]),s._v(" 通过注释修改配置：")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("plugins."),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"io.containerd.grpc.v1.cri"')]),s._v(".containerd.runtimes.kata"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n runtime_type "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"io.containerd.kata.v2"')]),s._v("\n privileged_without_host_devices "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("false")]),s._v("\n shim_debug "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),s._v("\n pod_annotations "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"io.katacontainers.*"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#  <-- look here")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])]),a("blockquote",[a("p",[s._v("io.katacontainers.config.hypervisor.default_vcpus = 5")])]),s._v(" "),a("h2",{attrs:{id:"打开-feature-gates-podoverhead"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#打开-feature-gates-podoverhead"}},[s._v("#")]),s._v(" 打开--feature-gates PodOverhead")]),s._v(" "),a("blockquote",[a("p",[s._v("/etc/kubernetes/manifests/kube-apiserver.yaml")])]),s._v(" "),a("p",[s._v("1.17默认关闭，1.18默认打开")]),s._v(" "),a("blockquote",[a("p",[s._v('Environment="KUBELET_FEATURE=--feature-gates=RotateKubeletServerCertificate=true,VolumeSnapshotDataSource=true,ExpandCSIVolumes=true,VolumePVCDataSource=true,ServiceTopology=true,EndpointSlice=true,PodOverhead=true"')])]),s._v(" "),a("h3",{attrs:{id:"启用runtimeclass准入控制"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#启用runtimeclass准入控制"}},[s._v("#")]),s._v(" 启用RuntimeClass准入控制")]),s._v(" "),a("blockquote",[a("p",[s._v("--feature-gates=VolumeSnapshotDataSource=true,ExpandCSIVolumes=true,VolumePVCDataSource=true,TTLAfterFinished=true,ServiceTopology=true,EndpointSlice=true,PodOverhead=true")])]),s._v(" "),a("h3",{attrs:{id:"设置podoverhead"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#设置podoverhead"}},[s._v("#")]),s._v(" 设置podOverHead")]),s._v(" "),a("div",{staticClass:"language-yaml line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("kind")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" RuntimeClass\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("apiVersion")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" node.k8s.io/v1beta1\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("metadata")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" kata"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("containers\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("handler")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" kata\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("overhead")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("podFixed")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("memory")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"100Mi"')]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("cpu")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"100m"')]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br")])]),a("h2",{attrs:{id:"virtio-mem内存热插拔-仅支持qemu"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#virtio-mem内存热插拔-仅支持qemu"}},[s._v("#")]),s._v(" virtio-mem内存热插拔（仅支持QEMU）")]),s._v(" "),a("p",[a("a",{attrs:{href:"https://github.com/kata-containers/kata-containers/blob/main/docs/how-to/how-to-use-virtio-mem-with-kata.md",target:"_blank",rel:"noopener noreferrer"}},[s._v("https://github.com/kata-containers/kata-containers/blob/main/docs/how-to/how-to-use-virtio-mem-with-kata.md"),a("OutboundLink")],1)]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("$ sudo sed -i -e 's/^#enable_virtio_mem.*$/enable_virtio_mem = true/g' /etc/kata-containers/configuration.toml\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("h1",{attrs:{id:"附件"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#附件"}},[s._v("#")]),s._v(" 附件")]),s._v(" "),a("div",{staticClass:"language-yaml line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("---")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("apiVersion")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" apps/v1\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("kind")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" Deployment\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("metadata")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" test"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("kata\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("spec")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("replicas")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("selector")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("matchLabels")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("app")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" test"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("kata\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("template")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("metadata")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("labels")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("app")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" test"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("kata\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("spec")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("runtimeClassName")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" kata"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("containers\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("containers")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("image")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" vish/stress\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("imagePullPolicy")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" IfNotPresent\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" cpu"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("stress"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("kata\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("resources")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n          "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("requests")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n            "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("memory")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"1Mi"')]),s._v("\n            "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("cpu")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"0.1"')]),s._v("\n          "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("limits")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n            "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("memory")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"161Mi"')]),s._v("\n            "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("cpu")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"350m"')]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("args")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("cpus\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"2"')]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("mem"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("total\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" 100Mi\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("mem"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("alloc"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("size\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" 10Mi\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("mem"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("alloc"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("sleep\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" 1s\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br"),a("span",{staticClass:"line-number"},[s._v("32")]),a("br"),a("span",{staticClass:"line-number"},[s._v("33")]),a("br"),a("span",{staticClass:"line-number"},[s._v("34")]),a("br"),a("span",{staticClass:"line-number"},[s._v("35")]),a("br"),a("span",{staticClass:"line-number"},[s._v("36")]),a("br")])])])}),[],!1,null,null,null);a.default=n.exports}}]);