(window.webpackJsonp=window.webpackJsonp||[]).push([[45],{371:function(s,a,t){"use strict";t.r(a);var n=t(0),e=Object(n.a)({},(function(){var s=this,a=s._self._c;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h1",{attrs:{id:"kata-rumtime"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#kata-rumtime"}},[s._v("#")]),s._v(" kata-rumtime")]),s._v(" "),a("ul",[a("li",[s._v("kata-runtime check")])]),s._v(" "),a("blockquote",[a("p",[s._v("WARN[0000] Not running network checks as super user      arch=amd64 name=kata-runtime pid=25571 source=runtime")]),s._v(" "),a("p",[s._v("System is capable of running Kata Containers")]),s._v(" "),a("p",[s._v("System can currently create Kata Containers")])]),s._v(" "),a("ul",[a("li",[a("p",[s._v("kata-runtime env")])]),s._v(" "),a("li",[a("p",[s._v("kata-runtime metrics fd77dc25ad3e958ded82cc5449c521a00b8300b71981370ba43a757e14ce7b19")])])]),s._v(" "),a("h2",{attrs:{id:"进入kata虚拟机-kata-runtime-exec"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#进入kata虚拟机-kata-runtime-exec"}},[s._v("#")]),s._v(" 进入kata虚拟机  kata-runtime  exec")]),s._v(" "),a("p",[a("a",{attrs:{href:"https://github.com/kata-containers/kata-containers/blob/main/docs/Developer-Guide.md#connect-to-debug-console",target:"_blank",rel:"noopener noreferrer"}},[s._v("https://github.com/kata-containers/kata-containers/blob/main/docs/Developer-Guide.md#connect-to-debug-console"),a("OutboundLink")],1)]),s._v(" "),a("p",[s._v("kata v2环境中考虑到安全性问题不能直接使用kata-runtime exec进入sandbox虚拟机，并且kata release版本的镜像没有包含登录组件，如果要登录需要重新制作sandbox文件系统，登录sandbox需要通过kata-monitor并且sandbox需要在kata-monitor启动之后再启动才能进行调试工作")]),s._v(" "),a("ul",[a("li",[s._v("修改配置 debug_console_enabled")])]),s._v(" "),a("blockquote",[a("p",[s._v("[agent.kata]\ndebug_console_enabled = true")])]),s._v(" "),a("ul",[a("li",[s._v("启动kata-monitor")])]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@rqy-k8s-1 kbuser"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# /opt/kata/bin/kata-monitor")]),s._v("\nINFO"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("0000"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" announce                    "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("app")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("kata-monitor "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("arch")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("amd64 git-commit"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("8d545f7438fc8b1189c1dcc8c414dcc50f7e5587 go-version"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("go1.17.3 listen-address"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"127.0.0.1:8090"')]),s._v(" log-level"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("info "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("os")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("linux runtime-endpoint"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/run/containerd/containerd.sock "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("version")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.3")]),s._v(".0\n\n\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 虚拟机里面，是个超级简化的系统，命令奇缺")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@rqy-k8s-1 kbuser"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kata-runtime exec 1b482bb4613ba606894d30370fe7637610a495d9b3a504bc36e9aa292db9a0f0")]),s._v("\nbash: grep: "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("command")]),s._v(" not found\nbash: grep: "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("command")]),s._v(" not found\nbash: tty: "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("command")]),s._v(" not found\nbash: expr: "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("command")]),s._v(" not found\nbash: "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v(": "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" integer expression expected\nbash-5.1"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#")]),s._v("\nbash-5.1"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#")]),s._v("\nbash-5.1"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# df -h")]),s._v("\nbash: df: "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("command")]),s._v(" not found\nbash-5.1"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# lsblk")]),s._v("\nNAME    MAJ:MIN RM  SIZE RO TYPE MOUNTPOINTS\npmem0   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("259")]),s._v(":0   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("  126M  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" disk\n`-pmem0p1 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("259")]),s._v(":1   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("  124M  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" part /\nbash-5.1"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ip addr")]),s._v("\nbash: ip: "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("command")]),s._v(" not found\nbash-5.1"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ifconfig")]),s._v("\nbash: ifconfig: "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("command")]),s._v(" not found\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 详情见[一个kata容器的创建示例]")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br")])]),a("h1",{attrs:{id:"crictl"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#crictl"}},[s._v("#")]),s._v(" crictl")]),s._v(" "),a("p",[s._v("ctr是containerd的一个客户端工具")]),s._v(" "),a("p",[s._v("crictl 是 CRI 兼容的容器运行时命令行接口，可以使用它来检查和调试 Kubernetes 节点上的容器运行时和应用程序")]),s._v(" "),a("p",[s._v("crictl 使用命名空间 k8s.io，即crictl image list = ctr -n=k8s.io image list")]),s._v(" "),a("p",[s._v("crictl config runtime-endpoint unix:///run/containerd/containerd.sock\ncrictl ps #同docker ps\ncrictl inspect\ncrictl exec\ncrictl pods # 可以查看哪些是kata容器\ncrictl images # 同docker images\ncrictl logs")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("crictl "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ps")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("grep")]),s._v(" stress\n86a94ad5059a4  14701355bb465   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("12")]),s._v(" minutes ago   Running    stress   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("    7247eaccec1b6\ncrictl inspect  86a94ad5059a4\ncrictl "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("exec")]),s._v(" -it  86a94ad5059a4 "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("bash")]),s._v("\nrictl stats 86a94ad5059a4\nCONTAINER    CPU %     MEM        DISK         INODES\n86a94ad5059a4  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("99.88")]),s._v("     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(".628GB       0B          "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("13")]),s._v("\ncrictl pods "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("grep")]),s._v(" stress\nbcfeedf0c17bf   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(" minutes ago    Ready   stress-b4fdd868-s8d7n     default     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("      kata\ncrictl images "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("grep")]),s._v(" vish/stress\ndocker.io/vish/stress      latest          14701355bb465    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(".56MB\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@localhost kata"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v('# POD_ID="$(sudo crictl pods --name test -q)"')]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@localhost kata"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# echo $POD_ID")]),s._v("\n2766411ac797b74cdb16fc7a042715e434cfa127c522e45ffe347bd5f7f88cbb\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@localhost kata"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# crictl inspectp -o=json $POD_ID | grep cgroupsPath")]),s._v("\n "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"cgroupsPath"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/kubepods/pod31c20d7a-3733-4b8c-8651-160b23868773/2766411ac797b74cdb16fc7a042715e434cfa127c522e45ffe347bd5f7f88cbb"')]),s._v(",\n "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@localhost kata"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# cat /sys/fs/cgroup/memory/kubepods/pod31c20d7a-3733-4b8c-8651-160b23868773/memory.limit_in_bytes")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("524288000")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@rqy-k8s-1 kbuser"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ls /run/vc/vm/")]),s._v("\n685a6f8538efaee72b1d38efd824aff76241b6ff307e75d3764b3d0606d33894  6d46a824dae01c4675da741ca2aff98b1e7eb005103d10cf0c3af6f758c97afe "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@rqy-k8s-1 kbuser"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kata-runtime exec 685a6f8538efaee72b1d38efd824aff76241b6ff307e75d3764b3d0606d33894 rpc error: code = DeadlineExceeded desc = timed out connecting to vsock 621008089:1026")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br")])]),a("h1",{attrs:{id:"ctr"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#ctr"}},[s._v("#")]),s._v(" ctr")]),s._v(" "),a("p",[s._v("ctr -n k8s.io image list")]),s._v(" "),a("p",[s._v("ctr -n k8s.io i export img.tar imgname")]),s._v(" "),a("p",[s._v("ctr -n k8s.io i import img.tar")]),s._v(" "),a("p",[s._v("ctr run -d imgname hfftest")]),s._v(" "),a("p",[s._v("// 测试增加--rm参数退出后删除，否则退出后进程不会删除\nctr -n k8s.io run --runtime io.containerd.kata.v2 -t --rm docker.io/xridge/fio:latest hfftest sh")]),s._v(" "),a("p",[s._v("ctr -n k8s.io t kill -s SIGKILL hfftest\nctr -n k8s.io t rm hfftest")]),s._v(" "),a("p",[s._v("ctr -n k8s.io  snapshot rm  hfftest\nctr -n k8s.io  container rm  hfftest")]),s._v(" "),a("p",[s._v("ctr -n k8s.io tasks list")]),s._v(" "),a("p",[s._v("ctr -n k8s.io task ps hfftest\nctr -n k8s.io t exec --exec-id $RANDOM -t hfftest sh")]),s._v(" "),a("h1",{attrs:{id:"镜像管理命令"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#镜像管理命令"}},[s._v("#")]),s._v(" 镜像管理命令")]),s._v(" "),a("p",[s._v("dockers images\nctr -n k8s.io images list\ncrictl images")]),s._v(" "),a("p",[s._v("docker inspect pause:3.1\ncrictl inspecti docker.io/vish/stress:latest\nctr无inspec命令")]),s._v(" "),a("p",[s._v("docker pull  vish/stress\nctr -n k8s.io pull vish/stress")]),s._v(" "),a("h1",{attrs:{id:"附件"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#附件"}},[s._v("#")]),s._v(" 附件")])])}),[],!1,null,null,null);a.default=e.exports}}]);