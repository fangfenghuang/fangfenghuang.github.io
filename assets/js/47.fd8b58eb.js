(window.webpackJsonp=window.webpackJsonp||[]).push([[47],{372:function(a,t,s){"use strict";s.r(t);var n=s(0),r=Object(n.a)({},(function(){var a=this,t=a._self._c;return t("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[t("h1",{attrs:{id:"docker-兼容问题"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#docker-兼容问题"}},[a._v("#")]),a._v(" docker 兼容问题")]),a._v(" "),t("ul",[t("li",[t("p",[a._v("kata已去掉docker cli支持，请使用crictl命令")])]),a._v(" "),t("li",[t("p",[a._v("DinD问题")])])]),a._v(" "),t("h1",{attrs:{id:"使用限制"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#使用限制"}},[a._v("#")]),a._v(" 使用限制：")]),a._v(" "),t("h2",{attrs:{id:"不支持subpaths-emptydir-使用"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#不支持subpaths-emptydir-使用"}},[a._v("#")]),a._v(" 不支持subPaths(emptyDir )使用")]),a._v(" "),t("h2",{attrs:{id:"kata不支持host网络"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#kata不支持host网络"}},[a._v("#")]),a._v(" kata不支持host网络")]),a._v(" "),t("p",[a._v("​\t\t一些使用主机网络的k8s组件和业务无法使用kata容器，所以runc（containerd）必须保留作为默认运行时，而kata-container作为可选运行时给特定负载使用。")]),a._v(" "),t("h2",{attrs:{id:"不支持网络命名空间共享"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#不支持网络命名空间共享"}},[a._v("#")]),a._v(" 不支持网络命名空间共享")]),a._v(" "),t("p",[a._v("​\t\tDocker 支持容器使用docker run --net=containers语法加入另一个容器命名空间的能力。这允许多个容器共享一个公共网络命名空间和放置在网络命名空间中的网络接口。Kata Containers 不支持网络命名空间共享。如果将 Kata 容器设置为共享runc容器的网络命名空间，则运行时会有效地接管分配给命名空间的所有网络接口并将它们绑定到 VM。因此，runc容器失去其网络连接。")]),a._v(" "),t("h2",{attrs:{id:"不支持cpuset-cpus"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#不支持cpuset-cpus"}},[a._v("#")]),a._v(" 不支持cpuset-cpus")]),a._v(" "),t("p",[a._v("https://github.com/kata-containers/runtime/issues/1079\ndocker run -d --cpuset-cpus= “ 0-1 ”   ubuntu sleep 30000")]),a._v(" "),t("h1",{attrs:{id:"ctr依赖-configuration-qemu-toml路径问题"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#ctr依赖-configuration-qemu-toml路径问题"}},[a._v("#")]),a._v(" ctr依赖/configuration-qemu.toml路径问题")]),a._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[a._v("/etc/kata-containers/configuration.toml已存在，为测试删除了默认配置文件，但是containerd配置保留\n\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("root@localhost ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# cat  /etc/containerd/config.toml ")]),a._v("\n      "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("plugins."),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('"io.containerd.grpc.v1.cri"')]),a._v(".containerd.runtimes.kata"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v("\n        runtime_type "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('"io.containerd.kata.v2"')]),a._v("\n        privileged_without_host_devices "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[a._v("true")]),a._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("plugins."),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('"io.containerd.grpc.v1.cri"')]),a._v(".containerd.runtimes.kata.options"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v("\n           ConfigPath "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('"/etc/kata-containers/configuration.toml"')]),a._v("\n\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("root@localhost ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# kubectl get runtimeclasses.node.k8s.io kata-containers -o yaml | grep handler")]),a._v("\nhandler: kata\n\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("root@localhost ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# ctr -n k8s.io run --runtime io.containerd.kata.v2 -t --rm docker.io/library/busybox:latest hfftest dmesg ")]),a._v("\nctr: Cannot "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("find")]),a._v(" usable config "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("file")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("file /opt/kata/share/defaults/kata-containers/configuration-qemu.toml does not exist"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(": not found\n\n\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("root@rqy-k8s-1 kbuser"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# ll /usr/local/bin/containerd-shim-kata-v2")]),a._v("\nlrwxrwxrwx. "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("1")]),a._v(" root root "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("43")]),a._v(" Mar "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("18")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("11")]),a._v(":31 /usr/local/bin/containerd-shim-kata-v2 -"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v(" /usr/local/bin/containerd-shim-kata-qemu-v2\n")])]),a._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[a._v("1")]),t("br"),t("span",{staticClass:"line-number"},[a._v("2")]),t("br"),t("span",{staticClass:"line-number"},[a._v("3")]),t("br"),t("span",{staticClass:"line-number"},[a._v("4")]),t("br"),t("span",{staticClass:"line-number"},[a._v("5")]),t("br"),t("span",{staticClass:"line-number"},[a._v("6")]),t("br"),t("span",{staticClass:"line-number"},[a._v("7")]),t("br"),t("span",{staticClass:"line-number"},[a._v("8")]),t("br"),t("span",{staticClass:"line-number"},[a._v("9")]),t("br"),t("span",{staticClass:"line-number"},[a._v("10")]),t("br"),t("span",{staticClass:"line-number"},[a._v("11")]),t("br"),t("span",{staticClass:"line-number"},[a._v("12")]),t("br"),t("span",{staticClass:"line-number"},[a._v("13")]),t("br"),t("span",{staticClass:"line-number"},[a._v("14")]),t("br"),t("span",{staticClass:"line-number"},[a._v("15")]),t("br"),t("span",{staticClass:"line-number"},[a._v("16")]),t("br"),t("span",{staticClass:"line-number"},[a._v("17")]),t("br"),t("span",{staticClass:"line-number"},[a._v("18")]),t("br")])]),t("h1",{attrs:{id:"kata-deploy重启-节点重启会导致配置还原问题-必现"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#kata-deploy重启-节点重启会导致配置还原问题-必现"}},[a._v("#")]),a._v(" kata deploy重启/节点重启会导致配置还原问题（必现）")]),a._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[a._v("cat")]),a._v(" /opt/kata/share/defaults/kata-containers/configuration-qemu.toml  "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("|")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("grep")]),a._v(" sandbox_cgroup_only\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("sandbox_cgroup_only")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("true\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("## 重启后")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("root@localhost ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# cat /opt/kata/share/defaults/kata-containers/configuration-qemu.toml  | grep sandbox_cgroup_only")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("sandbox_cgroup_only")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("false\n\n")])]),a._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[a._v("1")]),t("br"),t("span",{staticClass:"line-number"},[a._v("2")]),t("br"),t("span",{staticClass:"line-number"},[a._v("3")]),t("br"),t("span",{staticClass:"line-number"},[a._v("4")]),t("br"),t("span",{staticClass:"line-number"},[a._v("5")]),t("br"),t("span",{staticClass:"line-number"},[a._v("6")]),t("br"),t("span",{staticClass:"line-number"},[a._v("7")]),t("br")])]),t("h1",{attrs:{id:"资源开销问题"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#资源开销问题"}},[a._v("#")]),a._v(" 资源开销问题")]),a._v(" "),t("h2",{attrs:{id:"容器内fio测试-压内存-会导致host上对应qemu进程oom-或节点卡死-节点异常问题"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#容器内fio测试-压内存-会导致host上对应qemu进程oom-或节点卡死-节点异常问题"}},[a._v("#")]),a._v(" 容器内fio测试(压内存)会导致host上对应qemu进程oom，或节点卡死，节点异常问题")]),a._v(" "),t("p",[a._v("问题1： pod sanbox change，exec退出，pod重启次数加1\n问题2： 节点卡死，节点notrady，相同配置runc测试无该问题")]),a._v(" "),t("p",[a._v("怀疑： 未开启SandboxCgroupOnly，导致sanbox overhead无限制占用主机资源，导致节点异常，这样的话就说明kata的资源开销还是很大的。")]),a._v(" "),t("p",[a._v("开启SandboxCgroupOnly后测试卡死，但是pod/节点未异常,进程结束。。。\n所以，问题是，为什么没有错误信息")]),a._v(" "),t("h2",{attrs:{id:"overhead的cpu和内存占用应该纳入已分配配额"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#overhead的cpu和内存占用应该纳入已分配配额"}},[a._v("#")]),a._v(" Overhead的CPU和内存占用应该纳入已分配配额？？？")]),a._v(" "),t("h2",{attrs:{id:"容器使用内存不会自动release"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#容器使用内存不会自动release"}},[a._v("#")]),a._v(" 容器使用内存不会自动release？？")]),a._v(" "),t("h1",{attrs:{id:"存储性能问题"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#存储性能问题"}},[a._v("#")]),a._v(" 存储性能问题")]),a._v(" "),t("h2",{attrs:{id:"未enable-dax-fio测试结果较差"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#未enable-dax-fio测试结果较差"}},[a._v("#")]),a._v(" 未enable DAX, fio测试结果较差？？")]),a._v(" "),t("h1",{attrs:{id:"网络问题"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#网络问题"}},[a._v("#")]),a._v(" 网络问题")]),a._v(" "),t("h2",{attrs:{id:"qemu-不能直接使用-veth-pair-导致vm-container的网络拓扑比较复杂且容易有性能问题-kubevirt同样的问题"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#qemu-不能直接使用-veth-pair-导致vm-container的网络拓扑比较复杂且容易有性能问题-kubevirt同样的问题"}},[a._v("#")]),a._v(" qemu 不能直接使用 veth-pair, 导致vm+container的网络拓扑比较复杂且容易有性能问题, kubevirt同样的问题")]),a._v(" "),t("h1",{attrs:{id:"参考资料"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#参考资料"}},[a._v("#")]),a._v(" 参考资料")]),a._v(" "),t("p",[a._v("https://github.com/kata-containers/kata-containers/blob/main/docs/Limitations.md\nhttps://github.com/pulls?q=label%3Alimitation+org%3Akata-containers+is%3Aclosed\nhttps://github.com/chestack/k8s-blog/blob/master/kata-container/kata-container.md")])])}),[],!1,null,null,null);t.default=r.exports}}]);