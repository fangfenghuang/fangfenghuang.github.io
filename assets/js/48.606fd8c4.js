(window.webpackJsonp=window.webpackJsonp||[]).push([[48],{374:function(a,t,s){"use strict";s.r(t);var e=s(0),n=Object(e.a)({},(function(){var a=this,t=a._self._c;return t("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[t("h2",{attrs:{id:"journalctl-t-kata"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#journalctl-t-kata"}},[a._v("#")]),a._v(" journalctl -t kata")]),a._v(" "),t("p",[a._v("Kata containerd shimv2 运行时日志通过containerd，其日志将被发送到containerd日志指向的任何地方。")]),a._v(" "),t("p",[a._v("查看shimv2运行时日志：")]),a._v(" "),t("blockquote",[t("p",[a._v("$ sudo journalctl -t kata")])]),a._v(" "),t("h2",{attrs:{id:"journalctl-t-containerd"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#journalctl-t-containerd"}},[a._v("#")]),a._v(" journalctl -t containerd")]),a._v(" "),t("h1",{attrs:{id:"开启-debug-log"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#开启-debug-log"}},[a._v("#")]),a._v(" 开启 debug log")]),a._v(" "),t("p",[a._v("开启 debug log 可以帮助我们获得更详细的 log，除了 runtime 的 log，而且还能看到 agent 的 log，以及 guest OS 中 kernel 的 log（dmesg命令的输出）。")]),a._v(" "),t("p",[a._v("开启 debug log，需要修改两个配置文件：")]),a._v(" "),t("ul",[t("li",[t("p",[a._v('containerd 配置文件按如下修改即可：\n[debug]\nlevel = "debug"')])]),a._v(" "),t("li",[t("p",[a._v("Kata Containers需要开启 runtime 和 agent 的 debug log")])])]),a._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("root@localhost hff"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# cat /etc/kata-containers/configuration.toml | grep enable_debug")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#enable_debug = true")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#enable_debug = true")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#enable_debug = true")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("root@localhost hff"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# cat /etc/kata-containers/configuration.toml | grep kernel_params")]),a._v("\nkernel_params "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('""')]),a._v("\n\n\n$ "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("sudo")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("sed")]),a._v(" -i -e "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v("'s/^# *\\(enable_debug\\).*=.*$/\\1 = true/g'")]),a._v(" /etc/kata-containers/configuration.toml\n$ "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("sudo")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("sed")]),a._v(" -i -e "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('\'s/^kernel_params = "\\(.*\\)"/kernel_params = "\\1 agent.log=debug"/g\'')]),a._v(" /etc/kata-containers/configuration.toml\n\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("root@localhost hff"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# cat /etc/kata-containers/configuration.toml | grep enable_debug")]),a._v("\nenable_debug "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[a._v("true")]),a._v("\nenable_debug "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[a._v("true")]),a._v("\nenable_debug "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[a._v("true")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("root@localhost hff"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# cat /etc/kata-containers/configuration.toml | grep kernel_params")]),a._v("\nkernel_params "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('" agent.log=debug"')]),a._v("\n")])]),a._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[a._v("1")]),t("br"),t("span",{staticClass:"line-number"},[a._v("2")]),t("br"),t("span",{staticClass:"line-number"},[a._v("3")]),t("br"),t("span",{staticClass:"line-number"},[a._v("4")]),t("br"),t("span",{staticClass:"line-number"},[a._v("5")]),t("br"),t("span",{staticClass:"line-number"},[a._v("6")]),t("br"),t("span",{staticClass:"line-number"},[a._v("7")]),t("br"),t("span",{staticClass:"line-number"},[a._v("8")]),t("br"),t("span",{staticClass:"line-number"},[a._v("9")]),t("br"),t("span",{staticClass:"line-number"},[a._v("10")]),t("br"),t("span",{staticClass:"line-number"},[a._v("11")]),t("br"),t("span",{staticClass:"line-number"},[a._v("12")]),t("br"),t("span",{staticClass:"line-number"},[a._v("13")]),t("br"),t("span",{staticClass:"line-number"},[a._v("14")]),t("br"),t("span",{staticClass:"line-number"},[a._v("15")]),t("br"),t("span",{staticClass:"line-number"},[a._v("16")]),t("br"),t("span",{staticClass:"line-number"},[a._v("17")]),t("br")])]),t("p",[t("a",{attrs:{href:"https://github.com/kata-containers/kata-containers/blob/main/docs/Developer-Guide.md#troubleshoot-kata-containers",target:"_blank",rel:"noopener noreferrer"}},[a._v("https://github.com/kata-containers/kata-containers/blob/main/docs/Developer-Guide.md#troubleshoot-kata-containers"),t("OutboundLink")],1)]),a._v(" "),t("p",[t("a",{attrs:{href:"https://github.com/kata-containers/kata-containers/blob/main/docs/Developer-Guide.md#connect-to-debug-console",target:"_blank",rel:"noopener noreferrer"}},[a._v("https://github.com/kata-containers/kata-containers/blob/main/docs/Developer-Guide.md#connect-to-debug-console"),t("OutboundLink")],1),a._v("\n（进入虚拟机需要打开debug_console_enabled）")]),a._v(" "),t("h1",{attrs:{id:"tracing"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#tracing"}},[a._v("#")]),a._v(" tracing")]),a._v(" "),t("p",[t("a",{attrs:{href:"https://github.com/kata-containers/kata-containers/blob/main/docs/tracing.md",target:"_blank",rel:"noopener noreferrer"}},[a._v("https://github.com/kata-containers/kata-containers/blob/main/docs/tracing.md"),t("OutboundLink")],1)]),a._v(" "),t("h1",{attrs:{id:"kata-log-parser"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#kata-log-parser"}},[a._v("#")]),a._v(" kata-log-parser")]),a._v(" "),t("p",[t("a",{attrs:{href:"https://github.com/kata-containers/tests/tree/main/cmd/log-parser",target:"_blank",rel:"noopener noreferrer"}},[a._v("https://github.com/kata-containers/tests/tree/main/cmd/log-parser"),t("OutboundLink")],1)]),a._v(" "),t("h1",{attrs:{id:"kata-collect-data-sh"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#kata-collect-data-sh"}},[a._v("#")]),a._v(" kata-collect-data.sh")]),a._v(" "),t("p",[a._v("向社区提issue需要添加采集信息")]),a._v(" "),t("h1",{attrs:{id:"开启debug的开销"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#开启debug的开销"}},[a._v("#")]),a._v(" 开启debug的开销")]),a._v(" "),t("p",[a._v("开启前，已开启了debug_console_enabled，好像并不会因为pod增加而增加？")]),a._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("root@localhost hff"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# systemd-cgtop | grep kata")]),a._v("\n/kata_overhead                                                                                                                -      -     "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("2")]),a._v(".4M        -        -\n/kubepods/podfa152857-05d1-44fc-9cdc-d448b2c98941/kata_f40286f09e1ef5de468d894f1519c7ca6d30962653e7dce8daf90681802a0dde       "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("7")]),a._v("      -   "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("167")]),a._v(".8M        -        -\n/system.slice/kata-monitor.service                                                                                            "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("1")]),a._v("      -    "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("22")]),a._v(".2M        -        -\n")])]),a._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[a._v("1")]),t("br"),t("span",{staticClass:"line-number"},[a._v("2")]),t("br"),t("span",{staticClass:"line-number"},[a._v("3")]),t("br"),t("span",{staticClass:"line-number"},[a._v("4")]),t("br")])]),t("p",[a._v("按上述开启 debug log设置后")]),a._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("root@localhost hff"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# systemd-cgtop | grep kata")]),a._v("\n/kata_overhead                                                                                                                -      -     "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("2")]),a._v(".4M        -        -\n/kubepods/podfa152857-05d1-44fc-9cdc-d448b2c98941/kata_f40286f09e1ef5de468d894f1519c7ca6d30962653e7dce8daf90681802a0dde       "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("7")]),a._v("      -   "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("166")]),a._v(".6M        -        -\n/system.slice/kata-monitor.service                                                                                            "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("1")]),a._v("      -    "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("21")]),a._v(".8M        -        -\n")])]),a._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[a._v("1")]),t("br"),t("span",{staticClass:"line-number"},[a._v("2")]),t("br"),t("span",{staticClass:"line-number"},[a._v("3")]),t("br"),t("span",{staticClass:"line-number"},[a._v("4")]),t("br")])]),t("p",[a._v("dmesg日志")]),a._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("root@localhost hff"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# dmesg | grep kata")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("2056734.849647")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v(" containerd-shim "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("cpuset")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("kata_5051ee8a1c623152246de3245c514de818127663500f71c01ae4f2952dbdc73a "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("mems_allowed")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("0")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("2056734.849679")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v(" Task "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("in")]),a._v(" /kubepods/burstable/podf4bff02f-469b-4fbb-8152-5daafbe2cb3a/kata_5051ee8a1c623152246de3245c514de818127663500f71c01ae4f2952dbdc73a killed as a result of limit of /kubepods/burstable/podf4bff02f-469b-4fbb-8152-5daafbe2cb3a\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("2056734.849690")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v(" Memory cgroup stats "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("for")]),a._v(" /kubepods/burstable/podf4bff02f-469b-4fbb-8152-5daafbe2cb3a/kata_5051ee8a1c623152246de3245c514de818127663500f71c01ae4f2952dbdc73a: cache:188900KB rss:15900KB rss_huge:0KB mapped_file:188876KB swap:0KB inactive_anon:188372KB active_anon:16428KB inactive_file:0KB active_file:0KB unevictable:0KB\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("2056751.353176")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v(" pool "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("cpuset")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("kata_d888b88f19234d8148f43414242b99ec4de2d25e881d0453a920622da946c2e1 "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("mems_allowed")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("0")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("2056751.353223")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v(" Task "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("in")]),a._v(" /kubepods/burstable/podf4bff02f-469b-4fbb-8152-5daafbe2cb3a/kata_d888b88f19234d8148f43414242b99ec4de2d25e881d0453a920622da946c2e1 killed as a result of limit of /kubepods/burstable/podf4bff02f-469b-4fbb-8152-5daafbe2cb3a\n\n")])]),a._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[a._v("1")]),t("br"),t("span",{staticClass:"line-number"},[a._v("2")]),t("br"),t("span",{staticClass:"line-number"},[a._v("3")]),t("br"),t("span",{staticClass:"line-number"},[a._v("4")]),t("br"),t("span",{staticClass:"line-number"},[a._v("5")]),t("br"),t("span",{staticClass:"line-number"},[a._v("6")]),t("br"),t("span",{staticClass:"line-number"},[a._v("7")]),t("br")])])])}),[],!1,null,null,null);t.default=n.exports}}]);