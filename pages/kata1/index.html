<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>kata基本原理与架构 | hff</title>
    <meta name="generator" content="VuePress 1.9.5">
    <link rel="icon" href="/img/logo.ico">
    <link rel="stylesheet" href="https://at.alicdn.com/t/font_3114978_qe0b39no76.css">
    <script language="javascript" type="text/javascript" src="/js/pgmanor-self.js"></script>
    <meta name="description" content="​		Kata Containers项目来自于2017年12月合并的两个项目“IntelClear Containers”和“Hyper runV”，其目标是构建极其轻量级的VM，它们像容器一样执行，但提供工作负载隔离和添加虚拟机层的安全优势。">
    <meta name="image" content="https://fangfenghuang.github.io/../images/20220330151918.png">
    <meta name="twitter:title" content="kata基本原理与架构">
    <meta name="twitter:description" content="​		Kata Containers项目来自于2017年12月合并的两个项目“IntelClear Containers”和“Hyper runV”，其目标是构建极其轻量级的VM，它们像容器一样执行，但提供工作负载隔离和添加虚拟机层的安全优势。">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:image" content="https://fangfenghuang.github.io/../images/20220330151918.png">
    <meta name="twitter:url" content="https://fangfenghuang.github.io/01.%E6%8A%80%E6%9C%AF%E6%9D%82%E8%B0%88/03.kubernetes/303.kata-containers/01.kata%E5%88%9D%E8%AF%86/01.kata%E5%9F%BA%E6%9C%AC%E5%8E%9F%E7%90%86%E4%B8%8E%E6%9E%B6%E6%9E%84.html">
    <meta property="og:type" content="article">
    <meta property="og:title" content="kata基本原理与架构">
    <meta property="og:description" content="​		Kata Containers项目来自于2017年12月合并的两个项目“IntelClear Containers”和“Hyper runV”，其目标是构建极其轻量级的VM，它们像容器一样执行，但提供工作负载隔离和添加虚拟机层的安全优势。">
    <meta property="og:image" content="https://fangfenghuang.github.io/../images/20220330151918.png">
    <meta property="og:url" content="https://fangfenghuang.github.io/01.%E6%8A%80%E6%9C%AF%E6%9D%82%E8%B0%88/03.kubernetes/303.kata-containers/01.kata%E5%88%9D%E8%AF%86/01.kata%E5%9F%BA%E6%9C%AC%E5%8E%9F%E7%90%86%E4%B8%8E%E6%9E%B6%E6%9E%84.html">
    <meta property="og:site_name" content="fangfenghuang">
    <meta property="article:published_time" content="2022-07-27T14:56:49.000Z">
    <meta property="article:tag" content="null">
    <meta itemprop="name" content="kata基本原理与架构">
    <meta itemprop="description" content="​		Kata Containers项目来自于2017年12月合并的两个项目“IntelClear Containers”和“Hyper runV”，其目标是构建极其轻量级的VM，它们像容器一样执行，但提供工作负载隔离和添加虚拟机层的安全优势。">
    <meta itemprop="image" content="https://fangfenghuang.github.io/../images/20220330151918.png">
    <meta name="keywords" content="go,python,c,c++,vue,shell,php">
    <meta name="baidu-site-verification" content="code-LTKHwOecxI">
    <meta name="theme-color" content="#11a8cd">
    <meta name="referrer" content="no-referrer-when-downgrade">
    
    <link rel="preload" href="/assets/css/0.styles.3e92b113.css" as="style"><link rel="preload" href="/assets/js/app.0bdd2fd9.js" as="script"><link rel="preload" href="/assets/js/2.22dca872.js" as="script"><link rel="preload" href="/assets/js/3.759551b0.js" as="script"><link rel="prefetch" href="/assets/js/10.f0b9a357.js"><link rel="prefetch" href="/assets/js/11.5e9d4442.js"><link rel="prefetch" href="/assets/js/12.99680bb3.js"><link rel="prefetch" href="/assets/js/13.1a1923b0.js"><link rel="prefetch" href="/assets/js/14.180488df.js"><link rel="prefetch" href="/assets/js/15.e9102046.js"><link rel="prefetch" href="/assets/js/16.44ebcc1f.js"><link rel="prefetch" href="/assets/js/17.aa4b2699.js"><link rel="prefetch" href="/assets/js/18.916b7071.js"><link rel="prefetch" href="/assets/js/19.ddd597d8.js"><link rel="prefetch" href="/assets/js/20.7e323eba.js"><link rel="prefetch" href="/assets/js/21.fecfc403.js"><link rel="prefetch" href="/assets/js/22.a77bde3d.js"><link rel="prefetch" href="/assets/js/23.9357d434.js"><link rel="prefetch" href="/assets/js/24.03060b5c.js"><link rel="prefetch" href="/assets/js/25.fd66037c.js"><link rel="prefetch" href="/assets/js/26.6d180b09.js"><link rel="prefetch" href="/assets/js/27.b30a1b3a.js"><link rel="prefetch" href="/assets/js/28.bfecc27f.js"><link rel="prefetch" href="/assets/js/29.2d636a78.js"><link rel="prefetch" href="/assets/js/30.fef81364.js"><link rel="prefetch" href="/assets/js/31.cc9b927b.js"><link rel="prefetch" href="/assets/js/32.406d4543.js"><link rel="prefetch" href="/assets/js/33.97e99b26.js"><link rel="prefetch" href="/assets/js/34.bab17a05.js"><link rel="prefetch" href="/assets/js/35.8720472a.js"><link rel="prefetch" href="/assets/js/36.73e460da.js"><link rel="prefetch" href="/assets/js/37.71903fdc.js"><link rel="prefetch" href="/assets/js/38.44e70b9a.js"><link rel="prefetch" href="/assets/js/39.4d278504.js"><link rel="prefetch" href="/assets/js/4.3da5c23b.js"><link rel="prefetch" href="/assets/js/40.641de171.js"><link rel="prefetch" href="/assets/js/41.9f8f7a3c.js"><link rel="prefetch" href="/assets/js/42.e836ac36.js"><link rel="prefetch" href="/assets/js/43.4424eef2.js"><link rel="prefetch" href="/assets/js/44.6e54c07d.js"><link rel="prefetch" href="/assets/js/45.61e54b59.js"><link rel="prefetch" href="/assets/js/46.91a87caa.js"><link rel="prefetch" href="/assets/js/47.fd8b58eb.js"><link rel="prefetch" href="/assets/js/48.88fe5c46.js"><link rel="prefetch" href="/assets/js/49.db6081e9.js"><link rel="prefetch" href="/assets/js/5.3ff92d1d.js"><link rel="prefetch" href="/assets/js/50.5b8ce7b4.js"><link rel="prefetch" href="/assets/js/51.e806afa5.js"><link rel="prefetch" href="/assets/js/52.8246235e.js"><link rel="prefetch" href="/assets/js/53.c23af4ef.js"><link rel="prefetch" href="/assets/js/54.947cc370.js"><link rel="prefetch" href="/assets/js/55.d4e2485c.js"><link rel="prefetch" href="/assets/js/56.06aa4440.js"><link rel="prefetch" href="/assets/js/57.0679207d.js"><link rel="prefetch" href="/assets/js/58.40d49972.js"><link rel="prefetch" href="/assets/js/59.aed47acb.js"><link rel="prefetch" href="/assets/js/6.99f416e3.js"><link rel="prefetch" href="/assets/js/60.8553cb43.js"><link rel="prefetch" href="/assets/js/61.c7e9beb7.js"><link rel="prefetch" href="/assets/js/62.86812725.js"><link rel="prefetch" href="/assets/js/63.bdfe24b0.js"><link rel="prefetch" href="/assets/js/64.5819e0ad.js"><link rel="prefetch" href="/assets/js/65.e980dedd.js"><link rel="prefetch" href="/assets/js/66.08d13abd.js"><link rel="prefetch" href="/assets/js/67.a1916432.js"><link rel="prefetch" href="/assets/js/68.2ca3f1db.js"><link rel="prefetch" href="/assets/js/69.447cd8d2.js"><link rel="prefetch" href="/assets/js/7.d996c5d0.js"><link rel="prefetch" href="/assets/js/70.67b043a8.js"><link rel="prefetch" href="/assets/js/71.54dc8497.js"><link rel="prefetch" href="/assets/js/72.fc720c82.js"><link rel="prefetch" href="/assets/js/73.cac42c06.js"><link rel="prefetch" href="/assets/js/74.5ca5d211.js"><link rel="prefetch" href="/assets/js/75.9e78d055.js"><link rel="prefetch" href="/assets/js/76.6ebed90b.js"><link rel="prefetch" href="/assets/js/77.31c3ff71.js"><link rel="prefetch" href="/assets/js/78.762af288.js"><link rel="prefetch" href="/assets/js/79.4d45c4b5.js"><link rel="prefetch" href="/assets/js/8.daa84c44.js"><link rel="prefetch" href="/assets/js/80.0bf4aefd.js"><link rel="prefetch" href="/assets/js/81.87fe5de9.js"><link rel="prefetch" href="/assets/js/82.858ec18f.js"><link rel="prefetch" href="/assets/js/83.4178e13e.js"><link rel="prefetch" href="/assets/js/84.bff3f4ac.js"><link rel="prefetch" href="/assets/js/85.9c2433eb.js"><link rel="prefetch" href="/assets/js/86.989ee5bb.js"><link rel="prefetch" href="/assets/js/87.109d10f3.js"><link rel="prefetch" href="/assets/js/88.6c304368.js"><link rel="prefetch" href="/assets/js/89.c65e8b21.js"><link rel="prefetch" href="/assets/js/9.8582675e.js"><link rel="prefetch" href="/assets/js/90.a3aca545.js"><link rel="prefetch" href="/assets/js/91.07e30368.js"><link rel="prefetch" href="/assets/js/92.cf3c3d22.js"><link rel="prefetch" href="/assets/js/93.c5fd5bd3.js"><link rel="prefetch" href="/assets/js/94.cb715c42.js"><link rel="prefetch" href="/assets/js/95.f1d2f1e1.js"><link rel="prefetch" href="/assets/js/96.ec9d9bbb.js">
    <link rel="stylesheet" href="/assets/css/0.styles.3e92b113.css">
  </head>
  <body class="theme-mode-light">
    <div id="app" data-server-rendered="true"><div class="theme-container sidebar-open have-rightmenu"><header class="navbar blur"><div title="目录" class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/img/logo.png" alt="hff" class="logo"> <span class="site-name can-hide">hff</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">首页</a></div><div class="nav-item"><a href="/tech/" class="nav-link">学习</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="生活" class="dropdown-title"><a href="/life/" class="link-title">生活</a> <span class="title" style="display:none;">生活</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/ythx/" class="nav-link">养桃日记</a></li></ul></div></div><div class="nav-item"><a href="/about/" class="nav-link">关于</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="索引" class="dropdown-title"><a href="/categories/" class="link-title">索引</a> <span class="title" style="display:none;">索引</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/categories/" class="nav-link">分类</a></li><li class="dropdown-item"><!----> <a href="/tags/" class="nav-link">标签</a></li><li class="dropdown-item"><!----> <a href="/archives/" class="nav-link">归档</a></li><li class="dropdown-item"><h4></h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="https://github.com/fangfenghuang" target="_blank" rel="noopener noreferrer" class="nav-link external">
  github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-subitem"><a href="https://blog.csdn.net/qq_26572567" target="_blank" rel="noopener noreferrer" class="nav-link external">
  scdn
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-subitem"><a href="https://www.zhihu.com/people/huangfangfeng-20" target="_blank" rel="noopener noreferrer" class="nav-link external">
  知乎
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-subitem"><a href="https://www.linkedin.com/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  linkin
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="阅读" class="dropdown-title"><a href="/books/" class="link-title">阅读</a> <span class="title" style="display:none;">阅读</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4></h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/books/" class="nav-link">书单</a></li><li class="dropdown-subitem"><a href="/pages/dianzishu/" class="nav-link">电子书</a></li><li class="dropdown-subitem"><a href="/pages/yzbook/" class="nav-link">优质博客</a></li></ul></li></ul></div></div> <a href="https://github.com/fangfenghuang/fangfenghuang.github.io" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar-hover-trigger"></div> <aside class="sidebar" style="display:none;"><div class="blogger"><img src="/img/bg.jpeg"> <div class="blogger-info"><h3>hff</h3> <span>一个有思想的程序猿</span></div></div> <nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">首页</a></div><div class="nav-item"><a href="/tech/" class="nav-link">学习</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="生活" class="dropdown-title"><a href="/life/" class="link-title">生活</a> <span class="title" style="display:none;">生活</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/ythx/" class="nav-link">养桃日记</a></li></ul></div></div><div class="nav-item"><a href="/about/" class="nav-link">关于</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="索引" class="dropdown-title"><a href="/categories/" class="link-title">索引</a> <span class="title" style="display:none;">索引</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/categories/" class="nav-link">分类</a></li><li class="dropdown-item"><!----> <a href="/tags/" class="nav-link">标签</a></li><li class="dropdown-item"><!----> <a href="/archives/" class="nav-link">归档</a></li><li class="dropdown-item"><h4></h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="https://github.com/fangfenghuang" target="_blank" rel="noopener noreferrer" class="nav-link external">
  github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-subitem"><a href="https://blog.csdn.net/qq_26572567" target="_blank" rel="noopener noreferrer" class="nav-link external">
  scdn
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-subitem"><a href="https://www.zhihu.com/people/huangfangfeng-20" target="_blank" rel="noopener noreferrer" class="nav-link external">
  知乎
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-subitem"><a href="https://www.linkedin.com/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  linkin
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="阅读" class="dropdown-title"><a href="/books/" class="link-title">阅读</a> <span class="title" style="display:none;">阅读</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4></h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/books/" class="nav-link">书单</a></li><li class="dropdown-subitem"><a href="/pages/dianzishu/" class="nav-link">电子书</a></li><li class="dropdown-subitem"><a href="/pages/yzbook/" class="nav-link">优质博客</a></li></ul></li></ul></div></div> <a href="https://github.com/fangfenghuang/fangfenghuang.github.io" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>常用总结</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>踩坑记录</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>kubernetes</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/pages/k8s01/" class="sidebar-link">k8s基础</a></li><li><a href="/pages/k8s02/" class="sidebar-link">k8s存储</a></li><li><a href="/pages/k8s03/" class="sidebar-link">k8s网络</a></li><li><a href="/pages/k8s04/" class="sidebar-link">pod cgroup和资源限制</a></li><li><a href="/pages/k8s05/" class="sidebar-link">流量限制</a></li><li><a href="/pages/k8s06/" class="sidebar-link">网络策略calico</a></li><li><a href="/pages/k8s07/" class="sidebar-link">grafana和promuthues</a></li><li><a href="/pages/k8s08/" class="sidebar-link">etcd节点down机数据恢复</a></li><li><a href="/pages/k8s09/" class="sidebar-link">ceph</a></li><li><a href="/pages/k8s10/" class="sidebar-link">chrony</a></li><li><a href="/pages/k8s11/" class="sidebar-link">crd operator</a></li><li><a href="/pages/k8s12/" class="sidebar-link">cri之containerd shimv2</a></li><li><a href="/pages/harbor/" class="sidebar-link">harbor</a></li><li><a href="/pages/k8s14/" class="sidebar-link">helm chart</a></li><li><a href="/pages/Loongnix/" class="sidebar-link">Loongnix mips64</a></li><li><a href="/pages/k8s16/" class="sidebar-link">openebs-lvm-localpv</a></li><li><a href="/pages/ingressroute/" class="sidebar-link">traefik-IngressRoute</a></li><li><a href="/pages/devops/" class="sidebar-link">DevOps</a></li><li><a href="/pages/serverless/" class="sidebar-link">Serverless</a></li><li><a href="/pages/k8s20/" class="sidebar-link">k8s容器故障处理</a></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>k8s面试</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>kubevirt</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading open"><span>kata-containers</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><section class="sidebar-group collapsable is-sub-group depth-2"><p class="sidebar-heading open"><span>kata初识</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/pages/kata1/" aria-current="page" class="active sidebar-link">kata基本原理与架构</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level2"><a href="/pages/kata1/#the-speed-of-containers-the-security-of-vms" class="sidebar-link">The speed of containers, the security of VMs</a></li><li class="sidebar-sub-header level2"><a href="/pages/kata1/#项目思路" class="sidebar-link">项目思路：</a></li><li class="sidebar-sub-header level2"><a href="/pages/kata1/#安全隔离" class="sidebar-link">安全隔离</a></li><li class="sidebar-sub-header level2"><a href="/pages/kata1/#kata隔离效益" class="sidebar-link">kata隔离效益</a></li><li class="sidebar-sub-header level2"><a href="/pages/kata1/#减少虚拟化开销" class="sidebar-link">减少虚拟化开销</a></li><li class="sidebar-sub-header level2"><a href="/pages/kata1/#怎样接上容器的生态" class="sidebar-link">怎样接上容器的生态</a></li><li class="sidebar-sub-header level2"><a href="/pages/kata1/#和传统的runc的区别" class="sidebar-link">和传统的runC的区别</a></li><li class="sidebar-sub-header level2"><a href="/pages/kata1/#使用场景" class="sidebar-link">使用场景</a></li><li class="sidebar-sub-header level2"><a href="/pages/kata1/#kata-containers-2-x-vs-1-x" class="sidebar-link">Kata Containers 2.x vs 1.x</a></li><li class="sidebar-sub-header level2"><a href="/pages/kata1/#kata-runtime-shimv2" class="sidebar-link">kata Runtime (shimv2)</a></li><li class="sidebar-sub-header level2"><a href="/pages/kata1/#kata-agent" class="sidebar-link">kata-agent</a></li><li class="sidebar-sub-header level2"><a href="/pages/kata1/#虚拟化技术" class="sidebar-link">虚拟化技术</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/pages/kata1/#hypervisor" class="sidebar-link">hypervisor</a></li><li class="sidebar-sub-header level4"><a href="/pages/kata1/#qemu-system-x86-64" class="sidebar-link">qemu-system-x86_64</a></li><li class="sidebar-sub-header level3"><a href="/pages/kata1/#cgroup" class="sidebar-link">cgroup</a></li><li class="sidebar-sub-header level3"><a href="/pages/kata1/#客户机内核和镜像" class="sidebar-link">客户机内核和镜像</a></li><li class="sidebar-sub-header level3"><a href="/pages/kata1/#网络和存储" class="sidebar-link">网络和存储</a></li><li class="sidebar-sub-header level3"><a href="/pages/kata1/#cpu和内存" class="sidebar-link">CPU和内存</a></li><li class="sidebar-sub-header level3"><a href="/pages/kata1/#vsock" class="sidebar-link">VSOCK</a></li><li class="sidebar-sub-header level3"><a href="/pages/kata1/#kata-monitor" class="sidebar-link">kata monitor</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/pages/kata1/#技术要点总结" class="sidebar-link">技术要点总结</a></li><li class="sidebar-sub-header level2"><a href="/pages/kata1/#部署组件" class="sidebar-link">部署组件：</a></li><li class="sidebar-sub-header level2"><a href="/pages/kata1/#容器创建流程" class="sidebar-link">容器创建流程</a></li><li class="sidebar-sub-header level2"><a href="/pages/kata1/#环境要求" class="sidebar-link">环境要求：</a></li><li class="sidebar-sub-header level2"><a href="/pages/kata1/#对资源管理的一些影响" class="sidebar-link">对资源管理的一些影响</a></li><li class="sidebar-sub-header level2"><a href="/pages/kata1/#存储限制" class="sidebar-link">存储限制：</a></li><li class="sidebar-sub-header level2"><a href="/pages/kata1/#主机资源共享问题" class="sidebar-link">主机资源共享问题</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/pages/kata1/#privileged-containers" class="sidebar-link">Privileged containers</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/pages/kata1/#docker切换成containerd的使用影响" class="sidebar-link">docker切换成containerd的使用影响</a></li><li class="sidebar-sub-header level2"><a href="/pages/kata1/#镜像" class="sidebar-link">镜像：</a></li><li class="sidebar-sub-header level2"><a href="/pages/kata1/#网络限制" class="sidebar-link">网络限制</a></li><li class="sidebar-sub-header level2"><a href="/pages/kata1/#资源约束管理" class="sidebar-link">资源约束管理</a></li><li class="sidebar-sub-header level2"><a href="/pages/kata1/#内存相关问题" class="sidebar-link">内存相关问题：</a></li><li class="sidebar-sub-header level2"><a href="/pages/kata1/#runc、runtime、docker、containerd、cri-o一些名词解释" class="sidebar-link">runc、runtime、docker、containerd、cri-o一些名词解释</a></li><li class="sidebar-sub-header level2"><a href="/pages/kata1/#sandbox与container" class="sidebar-link">Sandbox与Container</a></li><li class="sidebar-sub-header level2"><a href="/pages/kata1/#k8s和docker分道扬镳的故事-v1-23之后" class="sidebar-link">k8s和docker分道扬镳的故事(v1.23之后)</a></li><li class="sidebar-sub-header level2"><a href="/pages/kata1/#docker-vs-containerd" class="sidebar-link">docker vs containerd</a></li><li class="sidebar-sub-header level2"><a href="/pages/kata1/#kata-containers-与-gvisor" class="sidebar-link">Kata Containers 与 gVisor</a></li><li class="sidebar-sub-header level2"><a href="/pages/kata1/#runc容器的安全性-隔离-问题" class="sidebar-link">runc容器的安全性（隔离）问题</a></li><li class="sidebar-sub-header level2"><a href="/pages/kata1/#理想的多租户状态" class="sidebar-link">理想的多租户状态</a></li><li class="sidebar-sub-header level2"><a href="/pages/kata1/#k8s的原生多租户解决方案" class="sidebar-link">k8s的原生多租户解决方案</a></li><li class="sidebar-sub-header level2"><a href="/pages/kata1/#kata-vs-container" class="sidebar-link">kata vs container</a></li><li class="sidebar-sub-header level2"><a href="/pages/kata1/#kata-vs-vm-openstack" class="sidebar-link">kata vs VM（openstack）</a></li><li class="sidebar-sub-header level2"><a href="/pages/kata1/#kata-vs-kubevirt" class="sidebar-link">kata vs kubevirt</a></li></ul></li><li><a href="/pages/kata2/" class="sidebar-link">kata网络和存储文件系统分析</a></li><li><a href="/pages/kata3/" class="sidebar-link">kata cgroup及资源限制</a></li><li><a href="/pages/kata4/" class="sidebar-link">guest kernel和guestos</a></li><li><a href="/pages/kata5/" class="sidebar-link">kata-monitor监控</a></li><li><a href="/pages/kata6/" class="sidebar-link">kata使用限制</a></li><li><a href="/pages/kata7/" class="sidebar-link">其他特性</a></li><li><a href="/pages/kata8/" class="sidebar-link">一个kata容器的创建示例</a></li></ul></section></li><li><section class="sidebar-group collapsable is-sub-group depth-2"><p class="sidebar-heading"><span>kata部署</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-2"><p class="sidebar-heading"><span>kata应用</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-2"><p class="sidebar-heading"><span>kataV3.0</span> <span class="arrow right"></span></p> <!----></section></li></ul></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>docker</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>日志采集</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>GPU</span> <span class="arrow right"></span></p> <!----></section></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>golang</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>python</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>计算机网络基础</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>虚拟化</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>运维脚本</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>软考高项</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <div><main class="page"><div class="theme-vdoing-wrapper "><div class="articleInfo-wrap" data-v-06225672><div class="articleInfo" data-v-06225672><ul class="breadcrumbs" data-v-06225672><li data-v-06225672><a href="/" title="首页" class="iconfont icon-home router-link-active" data-v-06225672></a></li> <li data-v-06225672><a href="/tech/#技术杂谈" data-v-06225672>技术杂谈</a></li><li data-v-06225672><a href="/tech/#kubernetes" data-v-06225672>kubernetes</a></li><li data-v-06225672><a href="/tech/#kata-containers" data-v-06225672>kata-containers</a></li><li data-v-06225672><a href="/tech/#kata初识" data-v-06225672>kata初识</a></li></ul> <div class="info" data-v-06225672><div title="作者" class="author iconfont icon-touxiang" data-v-06225672><a href="https://github.com/fangfenghuang" target="_blank" title="作者" class="beLink" data-v-06225672>hff</a></div> <div title="创建时间" class="date iconfont icon-riqi" data-v-06225672><a href="javascript:;" data-v-06225672>2022-07-27</a></div> <!----></div></div></div> <!----> <div class="content-wrapper"><div class="right-menu-wrapper"><div class="right-menu-margin"><div class="right-menu-title">目录</div> <div class="right-menu-content"></div></div></div> <h1><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAeCAYAAAA7MK6iAAAAAXNSR0IArs4c6QAABH1JREFUSA3tVl1oHFUUPmdmd2ltklqbpJDiNnXFmgbFktho7YMPNiJSSZM0+CAYSkUELVhM6YuwIPpgoOKDqOBDC0XE2CQoNtQXBUFTTcCi+Wlh1V2TQExsUzcltd3M9Tt3ZjZzZ2fT+OJTL8yeM+eee757fmeJbq//KQL8X3DUSFOcfr7cRsRtxNQMWueeVzOkaITIGqQHNg5y8+jNW9ldM7A6nTpAjuolUikAwq7CE3WcM2RRDz+XGVgN3FptU/aUSlvq9Pa3iZ1+sgAqJyyAFqkipd9dqiwHF3P65YycLWc/6sqGrvoEoIp6DOFaX5h6+dnfjkWprwqsPk0dUGq5vySwDImC10KxFHgGL1SWoc92O3eVht09qdXNH11I2SsTsJYqMWzihqGMi+A+Garf3BAuuLI5oGlULyNfyB/HYNujwktOfRrMr5t77NmevqaUopx0grnKAyvVpmwUDB4x6FPXuGvYLTDwWsejwgtgkYKPqRJg8SV6xaiZ3ZTppGneS4yfH5/66fZSDHv+QZci/+h5c5UHtpy67JUqGppM0sh0Nc1dW6/N1W5Yoqat8/TU/VnadmdeW2PLLSyh0cvxBs3KbqTmwYPpxN4do/mzE8nEpvX/UMu2Wbp74zUAK5q6WkHns7V0eWkdPbPzd3rxkTGybadYySumVzhcaJFbs5UrEkQ/+CK8gF5dnh/6ciIZ73gwQ927L1IitoxKLXYP3SjYdOrHHfTZhRRlFyrorafPk20B3HPD1y2G3qKZME5Jcf3t/HUC13/8tSd++vqFveMUTwAUxSUFI1QekR1+bIze3D9MF2aq6cPvG72CgnldWCFqyRw3lwH8ZMerjTD9ElRO7Gv44wNpC90aASqGfVlz/Rx17srQ57/UU26hkhQqUB7dBR71WmzQhHUnblGmVOEw0jhbV1n9OlXUDCIRGaNV5Jp43N516fN7JmnTHdfp7Hgy0luO4aMhtkLL8Bi3bUWYvzh5Mn1dTxrL6QmGuRhGL/TiTTxRoEdTszSaq9GR0NGA3KdkOz3hqSV3MIDhQ5IVX/Ivx3umBti2es2h4eZby7x8br1rkf7Mo90AqC8aQ3sJeNzqFRu+vSANAQe3PL7l0HGOAdwDCeZYvNKeoZp1Qfs6Aipndh86HmFRi0LAnEO47wsqM6cdfjh3jBPUzhZy7nvlUfFsamED1VQt6aISHVymXZ/B2aCtIG8AI8xfobj2d3en1wWVhOeHELKmLQ1s211s88comkv4UCwWyF787mJdYXtNfhKAXVqnKTq8QZvGAGGOfaTo5pGZ/PwbUCr5+DPr/1J92JNHr9aOl/F3iI5+O1nfybsGxoimvZ3ViWSluDITw3P37mypheDIPY0tw7+O/5ApbkYw+zpfaUVu32Pi98+defdUhEpZkRFq0aqyNh9FuL9hpYbEm6iwi0z2REd09ZmyENEbuhjDWzKvZXTqKYaBIr3tt5kuPtQBZFvEUwHt60vfCNu41XsksH9Ij1BMMz1Y0OOunHNShFIP5868g5zeXmuLwL9T4b6Q2+KejgAAAABJRU5ErkJggg==">kata基本原理与架构<span class="title-tag">原创</span></h1>  <div class="theme-vdoing-content content__default"><h1 id="安全容器-kata-containers"><a href="#安全容器-kata-containers" class="header-anchor">#</a> 安全容器-Kata containers</h1> <p>​	安全容器4类方案：</p> <ul><li>传统OS容器配合安全机制（runc + SELinux, AppArmor, … + rootless mode）</li> <li>用户态内核的容器（Google的gVisor）</li> <li>Library OS（UniKernel、Nabla Containers）</li> <li>轻量虚拟化的容器（Kata Containers、Firecracker）。</li></ul> <p>​		Kata Containers项目来自于2017年12月合并的两个项目“IntelClear Containers”和“Hyper runV”，其目标是构建极其轻量级的VM，它们像容器一样执行，但提供工作负载隔离和添加虚拟机层的安全优势。</p> <p>​		KataContainers社区于2018年5月发布了第一版1.0。由于Kata容器运行时兼容OCI，它可以无缝地插入Docker引擎和任何其他容器管理平台，如Kubernetes和Open-Stack，只需简单地将RUNC替换为Kata-runtime。</p> <p>​		Kata Containers 的本质就是一个精简后的轻量级虚拟机。</p> <h2 id="the-speed-of-containers-the-security-of-vms"><a href="#the-speed-of-containers-the-security-of-vms" class="header-anchor">#</a> The speed of containers, the security of VMs</h2> <p>安全体现在:</p> <p>在专用内核中运行，提供网络、I/O 和内存的隔离，并且可以利用硬件强制隔离和虚拟化 VT 扩展。</p> <p>容器体现在：</p> <p>兼容性上：支持OCI以及CRI接口，和容器一样操作。
性能上：启动速度达到百毫秒级，接近容器。
开销上：内存开销小，类似容器。
与Kubernetes和Docker无缝衔接，并且是runc的替代品
开源基础设施基金会下的开源治理项目
多架构支持：x86、ARM、IBM Power、IBM s/390x</p> <h2 id="项目思路"><a href="#项目思路" class="header-anchor">#</a> 项目思路：</h2> <ol><li>操作系统本身的容器机制没办法解决安全性问题，需要一个隔离层；</li> <li>虚拟机是一个现成的隔离层，AWS这样的云服务已经让全世界相信，对户来说，&quot;secure of VM&quot; 是可以满足需求的；</li> <li>虚机里面只要有个内核，就可以支持 OCI 规范的语义，在内核上跑个 Linux 应用这并不太难实现；</li> <li>虚机可能不够快，阻碍了它在容器环境的应用，那么可不可以拥有 &quot;speed of container&quot; 呢？
现在，如果最后一个问题可以解决，那么它就是我们要的“安全的容器”了——这就是 Kata Containers。</li></ol> <h2 id="安全隔离"><a href="#安全隔离" class="header-anchor">#</a> 安全隔离</h2> <p>安全性问题90%以上可以归结为隔离性问题</p> <ul><li><p>Docker安全隔离问题</p></li> <li><p>在Kata Containers中，每个容器都有自己的轻量级虚拟机和小内核，通过硬件虚拟化提供容器隔离。</p></li></ul> <h2 id="kata隔离效益"><a href="#kata隔离效益" class="header-anchor">#</a> kata隔离效益</h2> <p>​		kata 实际上是通过创建轻量级虚拟机实现容器之间的资源隔离，再在虚拟机中运行容器运行时，这样就使容器在专用内核中运行，提供网络，I / O和内存的隔离，并可以通过虚拟化VT扩展利用硬件强制隔离。</p> <p>传统的操作系统容器技术是内核进程管理的一个延伸，容器进程本身是一组关联的进程，对于宿主机的调度器来说是完全可见的，一个 Pod 里的所有容器或进程，同时也都被宿主机调度和管理。这就意味着，在有大量容器的环境下，宿主机内核的负担很重。而采纳安全容器之后，从宿主机上是看不到这些完整的信息的，隔离层同时也降低了宿主机的调度开销，减少了维护负担，避免了容器之间、容器和宿主机之间的服务质量干扰。</p> <p>安全容器作为一道屏障，可以让宿主机的运维管理操作不能直接访问到应用的数据，这样，把用户的应用数据直接保护在沙箱里就可以降低对用户的授权要求，保障用户的数据私密性。
<img src="/assets/img/20220330151918.77e8ccbd.png" alt=""> <img src="/assets/img/20220330151926.7f576462.png" alt=""></p> <h2 id="减少虚拟化开销"><a href="#减少虚拟化开销" class="header-anchor">#</a> 减少虚拟化开销</h2> <ul><li><p>通过“少用不必要的内存”和“共享能共享的内存”来降低内存的开销，更小的内存不仅开销更小，启动也更轻快</p></li> <li><p>最关键的性能优化来自Intel Clear Containers。</p></li> <li><p>最关键的优化其实就是VM的启动时间进行裁剪，优化。</p></li> <li><p>使用特定的Linux内核，使用简化的initrd以及rootfs。</p></li></ul> <h2 id="怎样接上容器的生态"><a href="#怎样接上容器的生态" class="header-anchor">#</a> 怎样接上容器的生态</h2> <p>​		kata-containers它本质上就一个容器的runtime。只要实现了OCI的接口就可以接上那些容器管理工具，只要实现了CRI接口，就可以接上k8s。</p> <p>​		所以kata-containers与OCI运行时规范兼容，可以通过CRI-O和Containerd实现与 Kubernetes CRI进行无缝协作。（Shim API）</p> <h2 id="和传统的runc的区别"><a href="#和传统的runc的区别" class="header-anchor">#</a> 和传统的runC的区别</h2> <p>​		最大的区别就在于container是放在虚拟机里面运行的，中间多了一层kernel后，外面的容器管理软件就无法管理，监控里面的进程、容器，也无法和里面通信。 解决方案就是在VM里面放了一个agent，内外通过VSOCK通信，这样子内外就打通了。</p> <h2 id="使用场景"><a href="#使用场景" class="header-anchor">#</a> 使用场景</h2> <ul><li><p>主要使用场景是在公有云模式</p></li> <li><p>裸金属基础设施</p></li> <li><p>混合工作负载生产环境</p></li> <li><p>监管和敏感的生产环境</p></li> <li><p>多租户容器集群</p></li> <li><p>具有内核相关功能的遗留的依赖内核的工作负载</p></li></ul> <h1 id="架构-kata2-0"><a href="#架构-kata2-0" class="header-anchor">#</a> 架构（Kata2.0）</h1> <p><a href="https://github.com/kata-containers/kata-containers/tree/main/docs/design/architecture" target="_blank" rel="noopener noreferrer">architecture<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p><img src="/assets/img/20220330163647.b81bd936.png" alt=""></p> <p><img src="/assets/img/20220330151947.a8d5403f.png" alt=""></p> <p>整个kata生态系统分为 3 部分：</p> <ul><li>容器调度系统（如 K8s）</li> <li>上层 runtime，这一层主要是实现了 CRI 接口，然后使用下层 runtime 对容器进行管理。上层 runtime 典型代表有 containerd 和 CRI-O。</li> <li>下层 runtime，这一层才会直接负责容器的管理，典型代表为 runc 和 Kata Containers。</li></ul> <p>对 Kata Containers 来说，Kata Containers 会接收来自上层 runtime 的请求，实现容器的创建、删除等管理工作。</p> <p>同时，上图中也有 3 个通信协议存在：</p> <ul><li>CRI： 容器运行时接口，这是 k8s（实际上是 kubelet）和 上层 runtime 之间的通信接口</li> <li>shim v2：上层 runtime （如 containerd ）和 下层 runtime（如 Kata Containers ） 之间的通信接口</li> <li>agent 协议：这是 Kata Containers 内部的协议，用于 Kata Containers 的 shim 进程和 guest 内的 agent 之间的通信。</li></ul> <h2 id="kata-containers-2-x-vs-1-x"><a href="#kata-containers-2-x-vs-1-x" class="header-anchor">#</a> Kata Containers 2.x vs 1.x</h2> <p>2.x 在开发上主要有以下几个重大的变更点：</p> <ul><li><p>agent 使用 Rust 重写</p></li> <li><p>只支持 shimv2，因此少了 proxy 和 shim 组件, shimv2 提供了 Containerd Runtime V2 (Shim API) 的 Kata 实现，从而使得 Kubernetes 场景下能够实现每个 Pod 一个 shim 进程 – shimv2。</p></li> <li><p>在 Kata Containers 2.x 中，核心组件只剩下两个：runtime 和agent ，且都在 kata-containers 这个 repo 下。</p></li></ul> <p>在kata1.x， kata-container可以当做docker的一个插件，启动kata-container可以通过docker命令，但是kata2.x之后，kata去掉了docker的cli，不能通过docker启动kata runtime容器。</p> <p>在 Kata 1.x 中，面向用户的主要组件是运行时（kata-runtime）。对于 Kata 2.0，主要组件是 Kata containerd shim v2。 对“ Kata 运行时”的任何提及均应指代 Kata containerd shim v2。</p> <h2 id="kata-runtime-shimv2"><a href="#kata-runtime-shimv2" class="header-anchor">#</a> kata Runtime (shimv2)</h2> <p>runtime 为运行在宿主机上的、支持 shim v2 协议的进程。在这系列文章中，多数情况下可以将 runtime 、shimv2 视为同一内容。</p> <p>整个 Runtime ，其可执行程序为 containerd-shim-kata-v2，也即 shim 进程，这也是 Kata Containers 的入口点。Runtime 对上接受 containerd 的请求（通过 shimv2 “协议”），对 guest 来说，通过 guest 内的 agent 来控制 guest 内容器的创建、删除等管理。</p> <p>Runtime 和 agent 之间的采用了 ttrpc 协议通信，这是一个使用了 protocol buffer 编解码方式的类似 gRPC 的通信方式。该协议由 containerd 创建，用于 containered 和底层 runtime 之间的通信。在 Kata Containers 中， runtime 和 agent 也通过 ttrpc 通信。</p> <p>http://liubin.org/kata-dev-book/src/runtime-arch.html</p> <h2 id="kata-agent"><a href="#kata-agent" class="header-anchor">#</a> kata-agent</h2> <p>agent 可以作为 guest init 进程启动，也可以使用 systemd 等作为 init ，agent 作为普通进程启动。
http://liubin.org/kata-dev-book/src/agent-arch.html</p> <p>https://github.com/kata-containers/kata-containers/tree/main/src/agent</p> <h2 id="虚拟化技术"><a href="#虚拟化技术" class="header-anchor">#</a> 虚拟化技术</h2> <p>kata sanbox/vm的接口
在虚拟机中，我们需要提供以下virtio设备：(qemu)</p> <ul><li>存储(virtio-fs)</li> <li>网络(tap): 基于性能考虑，qemu默认为vhost-net作为virtio-net 后端，默认配置还在评估中。</li> <li>控制（virtio-vsock）</li> <li>设备驱动（vfio）:设备直通</li> <li>动态资源管理(acpi): CPU、内存和设备热插拔</li></ul> <h3 id="hypervisor"><a href="#hypervisor" class="header-anchor">#</a> hypervisor</h3> <p>Kata Containers 支持多个ypervisor</p> <ul><li><p>QEMU 是一个成熟而复杂的管理程序。</p></li> <li><p>Firecracker 是AWS 为无服务器场景开发的轻量级hypervisor。它只支持有限的虚拟设备。</p></li> <li><p>Cloud-Hypervisor 是英特尔针对云原生场景设计的另一款轻量级hypervisor。</p></li> <li><p>ACRN 是针对边缘场景开发的hypervisor。</p></li></ul> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment">#  kata-runtime kata-env | awk -v RS= '/\[Hypervisor\]/' | grep Path</span>
  Path <span class="token operator">=</span> <span class="token string">&quot;/opt/kata/bin/qemu-system-x86_64&quot;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h4 id="qemu-system-x86-64"><a href="#qemu-system-x86-64" class="header-anchor">#</a> qemu-system-x86_64</h4> <h3 id="cgroup"><a href="#cgroup" class="header-anchor">#</a> cgroup</h3> <p>[[kata cgroup]]</p> <h3 id="客户机内核和镜像"><a href="#客户机内核和镜像" class="header-anchor">#</a> 客户机内核和镜像</h3> <p>[[guest kernel和guestos]]</p> <h3 id="网络和存储"><a href="#网络和存储" class="header-anchor">#</a> 网络和存储</h3> <p>[[kata网络和存储文件系统分析]]</p> <h3 id="cpu和内存"><a href="#cpu和内存" class="header-anchor">#</a> CPU和内存</h3> <p>[[kata CPU和内存]]</p> <h3 id="vsock"><a href="#vsock" class="header-anchor">#</a> VSOCK</h3> <p><a href="https://github.com/kata-containers/kata-containers/blob/main/docs/design/VSocks.md" target="_blank" rel="noopener noreferrer">Vsock<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h3 id="kata-monitor"><a href="#kata-monitor" class="header-anchor">#</a> kata monitor</h3> <p>[[kata-monitor监控指标]]</p> <h2 id="技术要点总结"><a href="#技术要点总结" class="header-anchor">#</a> 技术要点总结</h2> <ul><li><p>VM作为安全沙箱</p></li> <li><p>支持多种虚拟化方案，qemu、firecracker、cloud-hypervisor等</p></li> <li><p>vm中agent负责直接创建、更新、销毁容器</p></li> <li><p>使用vsock作为shim v2进程与agent的通信信道</p></li> <li><p>使用tc规则/macvtap连接veth和tap，来打通CNI和VM网络</p></li> <li><p>通过virtio-9p、virtio-fs将host上镜像挂载到vm中</p></li> <li><p>通过块设备透传，将host上块设备作为容器rootfs</p></li></ul> <p><strong>主要解决的问题：现有容器网络模型与现有虚拟机网络模型不匹配的问题，将CNI网络和虚机网络对接weth和tap连通方案：</strong></p> <ol><li><p>tcfilter：使用tc rules将veth的ingress和egress队列分别对接tap的egress和ingress队列实现veth和tap的直连</p></li> <li><p>macvtap：现有虚拟网卡连通技术</p></li></ol> <h2 id="部署组件"><a href="#部署组件" class="header-anchor">#</a> 部署组件：</h2> <p><strong>部署在主机上的：</strong></p> <ul><li><p>cloud-hypervisor, firecracker, qemu, 和支持的二进制文件</p></li> <li><p>containerd-shim-kata-v2</p></li> <li><p>kata-collect-data.sh</p></li> <li><p>kata-runtime</p></li></ul> <p><strong>镜像:</strong></p> <ul><li><p>kata-containers.img和kata-containers-initrd.img：从 Kata GitHub 发布页面中提取</p></li> <li><p>vmlinuz.container和vmlinuz-virtiofs.container：从 Kata GitHub 发布页面中提取</p></li></ul> <h2 id="容器创建流程"><a href="#容器创建流程" class="header-anchor">#</a> 容器创建流程</h2> <ul><li><p>用户创建容器</p></li> <li><p>容器管理器（containerd）创建kata runtime</p></li> <li><p>kata-runtime加载配置文件，调用shimv2 API</p></li> <li><p>kata-runtime运行hypervisor</p></li> <li><p>hypervisor创建和开启虚拟机VM（创建容器根环境rootfs）</p></li> <li><p>proxy作为 VM 引导的一部分启动</p></li> <li><p>运行时调用proxy的CreateSandboxAPI 请求proxy创建容器</p></li> <li><p>容器管理器将容器的控制权返回给运行ctr命令的用户</p></li></ul> <p>[[一个kata容器的创建示例]]</p> <h1 id="限制与约束"><a href="#限制与约束" class="header-anchor">#</a> 限制与约束:</h1> <p><strong>参考资料：</strong></p> <p><a href="https://github.com/kata-containers/kata-containers/blob/main/docs/Limitations.md" target="_blank" rel="noopener noreferrer">https://github.com/kata-containers/kata-containers/blob/main/docs/Limitations.md<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h2 id="环境要求"><a href="#环境要求" class="header-anchor">#</a> 环境要求：</h2> <ul><li><p>Kata Containers 需要嵌套虚拟化或裸机</p></li> <li><p>不支持k8s使用docker运行时，需要切换成containerd或cri-o</p></li></ul> <h2 id="对资源管理的一些影响"><a href="#对资源管理的一些影响" class="header-anchor">#</a> 对资源管理的一些影响</h2> <ul><li><p>无法进行container级别的控制 首先虚拟机本身就是host上的一个进程，仍然受host上的cgroup控制。所以仍然可以监控整个pod的资源使用数据，并控制pod的资源使用。 但是我们无法拿到container级别的数据，也无法直接通过host的cgroup来控制pod里面container的资源使用。</p></li> <li><p>虚拟化技术的一些影响</p></li> <li><p>虚拟化的overhead</p></li></ul> <h2 id="存储限制"><a href="#存储限制" class="header-anchor">#</a> 存储限制：</h2> <p>Kata 不支持 k8s subPath (emptydir?)</p> <p><a href="https://github.com/kata-containers/runtime/issues/2812" target="_blank" rel="noopener noreferrer">https://github.com/kata-containers/runtime/issues/2812<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p><a href="https://github.com/kata-containers/kata-containers/issues/1728" target="_blank" rel="noopener noreferrer">https://github.com/kata-containers/kata-containers/issues/1728<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>实测configmap没有问题，可能只对于emptydir使用有问题?</p> <h2 id="主机资源共享问题"><a href="#主机资源共享问题" class="header-anchor">#</a> 主机资源共享问题</h2> <p>RUNC可以启动一个容器以特权模式访问主机设备，而Kata-runtime也支持此选项，但在这种情况下，获得对客户VM设备的完全访问。尽管这个选项被视为一种限制，但从安全性的角度来看，它确实是一种优势，因为在容器的根升级的情况下，不会毒害主机内核。</p> <h3 id="privileged-containers"><a href="#privileged-containers" class="header-anchor">#</a> Privileged containers</h3> <p><a href="https://github.com/kata-containers/documentation/blob/master/Limitations.md#docker-run---privileged" target="_blank" rel="noopener noreferrer">https://github.com/kata-containers/documentation/blob/master/Limitations.md#docker-run---privileged<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p><a href="https://github.com/kata-containers/runtime/issues/1568" target="_blank" rel="noopener noreferrer">https://github.com/kata-containers/runtime/issues/1568<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p><a href="https://github.com/kata-containers/documentation/blob/master/how-to/privileged.md" target="_blank" rel="noopener noreferrer">https://github.com/kata-containers/documentation/blob/master/how-to/privileged.md<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>runc Kata 中的特权支持与容器有本质的不同。容器在来宾中以提升的功能运行，并被授予访问用户设备而不是主机设备的权限。securityContext privileged=true与 Kubernetes一起使用也是如此。</p> <p>在 runc 中，“--privileged”会将主机 dev 的功能转换为容器。</p> <p>在 Kata 中，“--privileged”意味着 Kata VM 中的容器可以访问 Kata guest VM 中的所有设备。</p> <h2 id="docker切换成containerd的使用影响"><a href="#docker切换成containerd的使用影响" class="header-anchor">#</a> docker切换成containerd的使用影响</h2> <h2 id="镜像"><a href="#镜像" class="header-anchor">#</a> 镜像：</h2> <ul><li>镜像不复用：</li></ul> <p>containerd采用自己的方式管理容器镜像，不能公用docker已有镜像，并且containerd镜像使用了命名空间进行了隔离，cri默认命名空间是k8s.io，containerd默认存储命名空间是default。</p> <ul><li>镜像构建</li></ul> <p>切换到 containerd 之后，需要注意 docker.sock 不再可用，也就意味着不能再在容器里面执行 docker 命令来构建镜像了，docker build 构建镜像的应用需要切换到无需 Dockerd 就可以构建镜像的工具，如 docker buildx、buildah、kaniko</p> <ul><li>日志配置</li></ul> <p>docker 和 containerd 除了在常用命令上有些区别外，在容器日志及相关参数配置方面也存在一些差异。</p> <h2 id="网络限制"><a href="#网络限制" class="header-anchor">#</a> 网络限制</h2> <ul><li>kata不支持host网络</li></ul> <p>一些使用主机网络的k8s组件和应用无法使用kata容器，所以runc（containerd）必须保留作为默认运行时，而kata-container作为可选运行时给特定负载使用。</p> <ul><li>Kata Containers 不支持网络命名空间共享</li></ul> <p>Docker 支持容器使用docker run --net=containers语法加入另一个容器命名空间的能力。这允许多个容器共享一个公共网络命名空间和放置在网络命名空间中的网络接口。Kata Containers 不支持网络命名空间共享。如果将 Kata 容器设置为共享runc容器的网络命名空间，则运行时会有效地接管分配给命名空间的所有网络接口并将它们绑定到 VM。因此，runc容器失去其网络连接。</p> <h2 id="资源约束管理"><a href="#资源约束管理" class="header-anchor">#</a> 资源约束管理</h2> <p>RUNC只使用控制组(cgroups)来限制、优先化、控制和计算资源，而对于kat-runtime，由于双安全层，为了得到相同的结果，可能有必要将约束应用到多个级别。因此，资源约束管理在RUNC中是粗粒度的，而在kata运行时是细粒度的。</p> <h2 id="内存相关问题"><a href="#内存相关问题" class="header-anchor">#</a> 内存相关问题：</h2> <p>虚拟机也应用了一些内存管理技术：KSM，balloon，这些可能也会对内存管理有一些影响。</p> <h1 id="一些知识扩展"><a href="#一些知识扩展" class="header-anchor">#</a> 一些知识扩展：</h1> <h2 id="runc、runtime、docker、containerd、cri-o一些名词解释"><a href="#runc、runtime、docker、containerd、cri-o一些名词解释" class="header-anchor">#</a> runc、runtime、docker、containerd、cri-o一些名词解释</h2> <p>runC是一个根据OCI标准创建并运行容器的命令行工具（CLI tool）(low-level runtime)。</p> <p>Docker就是基于runC创建的，简单地说，runC就是docker中最为核心的部分</p> <p>containerd是容器技术标准化之后的产物，为了能够兼容OCI标准，将容器运行时及其管理功能从Docker Daemon剥离。理论上，即使不运行dockerd，也能够直接通过containerd来管理容器。（当然，containerd本身也只是一个守护进程，容器的实际运行时由后面介绍的runC控制。）</p> <p>Kubelet 是一个CRI客户端，并期望CRI实现来处理接口的服务端。CRI-O和Containerd是依赖OCI兼容运行时来管理容器实例的CRI实现（high level runtime）。</p> <h2 id="sandbox与container"><a href="#sandbox与container" class="header-anchor">#</a> Sandbox与Container</h2> <p>Sandbox是一个统一、基本的隔离空间，一个虚拟机中只有一个Sandbox，但是该Sandbox内可以有多个容器，这就对应了Kubernetes Pod的模型；对于Docker来说，一般一个Sandbox内只运行一个Container。无论是哪种情况，Sandbox的ID与内部第一个容器的ID相同。</p> <h2 id="k8s和docker分道扬镳的故事-v1-23之后"><a href="#k8s和docker分道扬镳的故事-v1-23之后" class="header-anchor">#</a> k8s和docker分道扬镳的故事(v1.23之后)</h2> <p><a href="https://github.com/kubernetes/kubernetes/blob/master/CHANGELOG/CHANGELOG-1.20.md#dockershim-deprecation" target="_blank" rel="noopener noreferrer">https://github.com/kubernetes/kubernetes/blob/master/CHANGELOG/CHANGELOG-1.20.md#dockershim-deprecation<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p><a href="https://kubernetes.io/zh/blog/2020/12/02/dont-panic-kubernetes-and-docker/" target="_blank" rel="noopener noreferrer">https://kubernetes.io/zh/blog/2020/12/02/dont-panic-kubernetes-and-docker/<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>docker是一个完整的技术堆栈，是一个用户友好的抽象层，但是，对于k8s来说，并不是设计用来嵌入到 Kubernetes的（非CRI容器运行时接口），实际上k8s需要的是containerd（docker中的一个高级运行时功能），由于Docker 不兼容 CRI，Kubernetes 集群不得不引入一个叫做 Dockershim 的工具来访问它真正需要的 containerd。（增加运维成本，容易出错）。</p> <p>于是k8s决定不再支持Dockershim，用户应该将容器运行时从 Docker 切换到其他受支持的容器运行时。</p> <h2 id="docker-vs-containerd"><a href="#docker-vs-containerd" class="header-anchor">#</a> docker vs containerd</h2> <p>docker由 docker-client ,dockerd,containerd,docker-shim,runc组成，所以containerd是docker的基础组件之一</p> <p>从k8s的角度看，可以选择 containerd 或 docker 作为运行时组件：Containerd 调用链更短，组件更少，更稳定，占用节点资源更少</p> <p>调用链</p> <p><strong>Docker 作为 k8s 容器运行时，调用关系如下：</strong></p> <p>kubelet --&gt; docker shim （在 kubelet 进程中） --&gt; dockerd --&gt; containerd</p> <p><strong>Containerd 作为 k8s 容器运行时，调用关系如下：</strong></p> <p>kubelet --&gt; cri plugin（在 containerd 进程中） --&gt; containerd</p> <h2 id="kata-containers-与-gvisor"><a href="#kata-containers-与-gvisor" class="header-anchor">#</a> Kata Containers 与 gVisor</h2> <p>在2018年，Google 公司则发布了一个名叫 gVisor 的项目。gVisor 项目给容器进程配置一个用 Go 语言实现的、运行在用户态的、极小的“独立内核”。这个内核对容器进程暴露 Linux 内核 ABI，扮演着“Guest Kernel”的角色，从而达到了将容器和宿主机隔离开的目的。</p> <p>kata和gvisor的本质，都是给进程分配了一个独立的操作系统内核，从而避免了让容器共享宿主机的内核。这样，容器进程能够看到的攻击面，就从整个宿主机内核变成了一个极小的、独立的、以容器为单位的内核，从而有效解决了容器进程发生“逃逸”或者夺取整个宿主机的控制权的问题。</p> <p>而它们的区别在于，Kata Containers 使用的是传统的虚拟化技术，通过虚拟硬件模拟出了一台“小虚拟机”，然后在这个小虚拟机里安装了一个裁剪后的 Linux 内核来实现强隔离。</p> <p>而 gVisor 的做法则更加激进，Google 的工程师直接用 Go 语言“模拟”出了一个运行在用户态的操作系统内核，然后通过这个模拟的内核来代替容器进程向宿主机发起有限的、可控的系统调用。</p> <h2 id="runc容器的安全性-隔离-问题"><a href="#runc容器的安全性-隔离-问题" class="header-anchor">#</a> runc容器的安全性（隔离）问题</h2> <p>Docker的安全问题本质上就是容器技术的安全性问题：基于软件隔离，这包括共用内核问题以及Namespace还不够完善的限制：</p> <ol><li>/proc、/sys等未完全隔离</li> <li>Top, free, iostat等命令展示的信息未隔离</li> <li>Root用户未隔离</li> <li>/dev设备未隔离</li> <li>内核模块未隔离</li> <li>SELinux、time、syslog等所有现有Namespace之外的信息都未隔离
镜像本身不安全也会导致安全性问题。</li></ol> <h2 id="理想的多租户状态"><a href="#理想的多租户状态" class="header-anchor">#</a> 理想的多租户状态</h2> <p>理想来说，平台的各个租户（tenant）之间应该无法感受到彼此的存在，表现得就像每个租户独占整个平台一样。具体来说就是，我不能看到其它租户的资源，我的资源跑满了，也不能影响其它租户的资源使用。我无法从网络或内核上其它租户。</p> <p>Kubernetes 当然做不到，其中最大的两个原因是：</p> <ul><li><p>kube-apiserver 是整个集群中的单例，并且没有多租户概念；</p></li> <li><p>默认的 oci-runtime 是 runc，而 runc 启动的容器是共享内核的。</p></li></ul> <h2 id="k8s的原生多租户解决方案"><a href="#k8s的原生多租户解决方案" class="header-anchor">#</a> k8s的原生多租户解决方案</h2> <ul><li>命名空间隔离√</li> <li>RBAC权限管理√</li> <li>资源配额ResourceQuota√</li> <li>Pod Security Policy</li> <li>pod调度：绑定节点、污点容忍√</li> <li>网络策略限制√</li> <li>服务网格：Istio√</li> <li>StorageClass存储资源隔离（感觉意义不大）</li> <li>多集群隔离管理</li></ul> <h2 id="kata-vs-container"><a href="#kata-vs-container" class="header-anchor">#</a> kata vs container</h2> <p><img src="/assets/img/20220330153232.d98690db.png" alt=""></p> <h2 id="kata-vs-vm-openstack"><a href="#kata-vs-vm-openstack" class="header-anchor">#</a> kata vs VM（openstack）</h2> <p><img src="/assets/img/20220330153401.57b83078.png" alt=""></p> <h2 id="kata-vs-kubevirt"><a href="#kata-vs-kubevirt" class="header-anchor">#</a> kata vs kubevirt</h2> <ul><li>(kata)：在虚拟机内使用容器：可以创建一个包含多个容器的应用，并且都在虚拟机内运行；可以同时在多个虚拟机上创建/销毁容器，而虚拟机则可在使用现有虚拟机基础设施在物理服务器之间迁移。</li> <li>(kubevirt)：在容器内使用虚拟机：利用资源管理技术；利用构建和部署工具</li> <li>Kubevirt是借用Kubernetes的扩展性来管理VM（通过CRD管理虚拟机），你用到的是一个<strong>真正的VM</strong>；</li> <li>KubeVirt旨在提供尽可能多的虚拟机功能</li> <li>Kata-container是一个容器运行时，有着VM的安全性和隔离性，以容器的方式运行，有着容器的速度和特点，但不是一个真正的VM；Kata容器则试图为虚拟机提供类似容器的体验</li> <li>Virtlet是把VM当成一个CRI来跑了，是按Pod API来定义一个VM，所以VM的很多功能比如热迁移等，Virtlet是没法满足VM的全部特性的，算是一个<strong>70%功能的VM</strong></li></ul> <h1 id="参考资料"><a href="#参考资料" class="header-anchor">#</a> 参考资料</h1> <p>https://github.com/kata-containers</p></div></div>  <div class="page-edit"><!----> <!----> <div class="last-updated"><span class="prefix">上次更新:</span> <span class="time">2022/08/24, 18:07:47</span></div></div> <div class="page-nav-wapper"><!----> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/pages/kubevirtdeploy/" class="prev">kubevirt部署</a></span> <span class="next"><a href="/pages/kata2/">kata网络和存储文件系统分析</a>→
      </span></p></div></div></div> <div class="article-list"><div class="article-title"><a href="/archives/" class="iconfont icon-bi">最近更新</a></div> <div class="article-wrapper"><dl><dd>01</dd> <dt><a href="/pages/ythx/"><div>
            养桃花销
            <span class="title-tag">
              原创
            </span></div></a> <span class="date">12-25</span></dt></dl><dl><dd>02</dd> <dt><a href="/pages/ce72c9/"><div>
            关于cgroup
            <span class="title-tag">
              原创
            </span></div></a> <span class="date">10-22</span></dt></dl><dl><dd>03</dd> <dt><a href="/pages/8e65c0/"><div>
            关于cpu内存
            <span class="title-tag">
              原创
            </span></div></a> <span class="date">10-22</span></dt></dl> <dl><dd></dd> <dt><a href="/archives/" class="more">更多文章&gt;</a></dt></dl></div></div></main></div> <div class="footer"><div class="icons"><a href="https://github.com/fangfenghuang" title="GitHub" target="_blank" class="iconfont icon-github"></a><a href="mailto:15068704759@163.com" title="发邮件" target="_blank" class="iconfont icon-youjian"></a><a href="https://www.linkedin.com/in/huang-fangfeng-60887981/" title="linkedin" target="_blank" class="iconfont icon-rss"></a></div> 
  Theme by
  <a href="https://github.com/xugaoyi/vuepress-theme-vdoing" target="_blank" title="本站主题">Vdoing</a> 
    | Copyright © 2022-2022
    <span>| <a rel="nofollow " target="_blank" href="https://github.com/fangfenghuang/fangfenghuang.GitHub.io">@fangfenghuang</a></span></div> <div class="buttons"><div title="返回顶部" class="button blur go-to-top iconfont icon-fanhuidingbu" style="display:none;"></div> <div title="去评论" class="button blur go-to-comment iconfont icon-pinglun" style="display:none;"></div> <div title="主题模式" class="button blur theme-mode-but iconfont icon-zhuti"><ul class="select-box" style="display:none;"><li class="iconfont icon-zidong">
          跟随系统
        </li><li class="iconfont icon-rijianmoshi">
          浅色模式
        </li><li class="iconfont icon-yejianmoshi">
          深色模式
        </li><li class="iconfont icon-yuedu">
          阅读模式
        </li></ul></div></div> <!----> <!----> <!----></div><div class="global-ui"><canvas id="vuepress-canvas-cursor"></canvas><!----><PageInfo></PageInfo><BlockToggle></BlockToggle></div></div>
    <script src="/assets/js/app.0bdd2fd9.js" defer></script><script src="/assets/js/2.22dca872.js" defer></script><script src="/assets/js/3.759551b0.js" defer></script>
  </body>
</html>
